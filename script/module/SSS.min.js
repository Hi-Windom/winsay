import*as API from"../utils/api.min.js";import*as config from"../config.js";function createSofillToolbar(){var e=document.getElementById("toolbar"),t=document.getElementById("SofillToolbar"),o=document.getElementById("windowControls");t&&e.removeChild(t),(t=API.insertCreateBefore(o,"div","SofillToolbar")).style.marginRight="3px",t.style.marginTop="1px",t.style.marginLeft="10px"}function AndroidChangeColor(){var e=document.getElementById("SofillToolbar");if(null==e){var t=document.getElementById("toolbarEdit"),o=document.getElementById("windowControls");null==t&&null!=o?((e=document.createElement("div")).id="SofillToolbar",e.style.marginRight="3px",e.style.marginTop="1px",e.style.marginLeft="10px",o.parentElement.insertBefore(e,o)):null!=t&&((e=API.insertCreateBefore(t,"div","SofillToolbar")).style.position="relative",e.style.height="25px",e.style.overflowY="scroll",e.style.paddingTop="7px",e.style.marginRight="9px",e.style.marginLeft="10px")}const n=API.addinsertCreateElement(e,"div");n.id=config.IDs.BUTTON_TOOLBAR_CHANGE_COLOR,n.style.width="17px",n.style.height="100%",n.style.float="left",n.style.marginLeft="10px",n.style.backgroundImage="url(/appearance/themes/Sofill-/src/S2.svg)",n.style.backgroundRepeat="no-repeat",n.style.backgroundPosition="left top",n.style.backgroundSize="100%",n.addEventListener("click",(e=>{const t=window.theme.iter.next().value;switch(window.funs.getThemeMode){case"dark":localStorage.setItem(config.latest_DC_href,t);break;case"light":default:localStorage.setItem(config.latest_LC_href,t);break}window.funs.updateStyle(config.IDs.STYLE_COLOR,t)}))}function iterLC(){let e=[],t=[],o=localStorage.getItem(config.latest_LC_href);if(window.theme.iter=config.Iterator(e),o){t=config.colors,t.forEach((t=>e.push(`${config.THEME_ROOT}${t}`))),window.funs.updateStyle(config.IDs.STYLE_COLOR,o);for(let e=0;e<t.length&&window.theme.iter.next().value!==o;++e);}else new Promise((function(e){var t=new XMLHttpRequest;t.open("POST","http://127.0.0.1:6806/api/file/getFile",!0),t.setRequestHeader("Content-type","application/json");var o={path:config.config_UI};t.send(JSON.stringify(o)),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var o=t.responseText;e(JSON.parse(o))}}})).then((function(n){t=config.colors,t.forEach((t=>e.push(`${config.THEME_ROOT}${t}`))),window.theme.iter=config.Iterator(e),o=`/appearance/themes/Sofill-/style-S2/${n.color.light}`,localStorage.setItem(config.latest_LC_href,o),window.funs.updateStyle(config.IDs.STYLE_COLOR,o);for(let e=0;e<t.length&&window.theme.iter.next().value!==o;++e);}))}function iterDC(){let e=[],t=[],o=localStorage.getItem(config.latest_DC_href);if(window.theme.iter=config.Iterator2(e),o){t=config.colors2,t.forEach((t=>e.push(`${config.THEME_ROOT}${t}`))),window.funs.updateStyle(config.IDs.STYLE_COLOR,o);for(let e=0;e<t.length&&window.theme.iter.next().value!==o;++e);}else new Promise((function(e){var t=new XMLHttpRequest;t.open("POST","http://127.0.0.1:6806/api/file/getFile",!0),t.setRequestHeader("Content-type","application/json");var o={path:config.config_UI};t.send(JSON.stringify(o)),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var o=t.responseText;e(JSON.parse(o))}}})).then((function(n){t=config.colors2,t.forEach((t=>e.push(`${config.THEME_ROOT}${t}`))),window.theme.iter=config.Iterator2(e),o=`/appearance/themes/Sofill-/style-S2/${n.color.dark}`,localStorage.setItem(config.latest_DC_href,o),window.funs.updateStyle(config.IDs.STYLE_COLOR,o);for(let e=0;e<t.length&&window.theme.iter.next().value!==o;++e);}))}function DesktopChangeColor(){const e=document.getElementById("drag");if(config.themeStyle){const t=document.createElement("button");t.id=config.IDs.BUTTON_TOOLBAR_CHANGE_COLOR,t.className="toolbar__item b3-tooltips b3-tooltips__sw",t.ariaLabel="形态切换（实验性）",t.innerHTML='<svg><use xlink:href="#iconTheme"></use></svg>',t.addEventListener("click",(e=>{const t=window.theme.iter.next().value;switch(window.funs.getThemeMode){case"dark":localStorage.setItem(config.latest_DC_href,t);break;case"light":default:localStorage.setItem(config.latest_LC_href,t);break}window.funs.updateStyle(config.IDs.STYLE_COLOR,t)})),null==document.getElementById(config.IDs.BUTTON_TOOLBAR_CHANGE_COLOR)&&e.insertAdjacentElement("afterend",t)}}async function changeStyleMod(){switch(window.funs.getThemeMode){case"dark":iterDC();break;case"light":default:iterLC();break}API.isPhone()?(AndroidChangeColor(),createSofillToolbar()):DesktopChangeColor()}function changeThemeModeByApp(){let e=null;switch(window.funs.getThemeMode){case"light":e="/appearance/themes/Sofill-/style-S2/root-base-light.css",config.colors2.forEach((e=>API.removejscssfile(`${config.THEME_ROOT}${e}`,"css"))),API.removejscssfile("/appearance/themes/Sofill-/style-S2/root-base-dark.css","css");break;case"dark":default:e="/appearance/themes/Sofill-/style-S2/root-base-dark.css",config.colors.forEach((e=>API.removejscssfile(`${config.THEME_ROOT}${e}`,"css"))),API.removejscssfile("/appearance/themes/Sofill-/style-S2/root-base-light.css","css");break}window.funs.updateStyle(config.ID_COLOR_STYLE,e),changeStyleMod()}window.theme.changeThemeModeByEnv=function(){switch(config.cv_result){case-1:window.funs.updateStyle("MI","/appearance/themes/Sofill-/style-old/v2.4.1.old__MI__MI-TabBar.min.css");break;default:window.funs.updateStyle("MI","/appearance/themes/Sofill-/style/MI.css");break}switch(window.theme.OS){case"android":window.funs.updateStyle("MI-DocTree","/appearance/themes/Sofill-/style/MI-DocTree.css"),window.funs.updateStyle("Mobile","/appearance/themes/Sofill-/style/android/Mobile.css");break;default:window.funs.updateStyle("MI-DocTree","/appearance/themes/Sofill-/style/MI-DocTree.css"),window.funs.updateStyle("MI-Doc&Breadcrumb","/appearance/themes/Sofill-/style/MI-Doc&Breadcrumb.css");break}},window.theme.changeThemeModeByEnv(),setTimeout((()=>{changeThemeModeByApp()}),0);