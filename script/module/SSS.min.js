import*as API from"./../utils/api.min.js";import*as config from"./../config.js";var fs=null;function createAndroidSofillToolbar(){if("body--mobile"==config.clientMode){var e=document.getElementById("SofillToolbar");if(null==e){var t=document.getElementById("toolbarEdit");(e=API.insertCreateBefore(t,"div","SofillToolbar")).style.position="relative",e.style.height="25px",e.style.overflowY="scroll",e.style.paddingTop="7px",e.style.marginRight="3px",e.style.marginLeft="10px"}}}function AndroidChangeColor(){if("body--mobile"!=config.clientMode)return;if(document.getElementById(config.IDs.BUTTON_TOOLBAR_CHANGE_COLOR))return;var e=document.getElementById("SofillToolbar");const t=API.addinsertCreateElement(e,"div");t.id=config.IDs.BUTTON_TOOLBAR_CHANGE_COLOR,t.style.width="17px",t.style.height="100%",t.style.float="left",t.style.marginLeft="10px",t.style.backgroundImage="url(/appearance/themes/Sofill-/src/icon/S2.svg)",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="left top",t.style.backgroundSize="100%",t.addEventListener("click",(e=>{const t=window.theme.iter.next().value;switch(window.funs.getThemeMode){case"dark":localStorage.setItem(config.latest_DC_ID,t),localStorage.setItem("SC_winsay_cp_custom__DS",t),(o=document.getElementById("SC_winsay_cp_custom__DS"))&&(o.value=t);break;case"light":default:var o;if(localStorage.setItem(config.latest_LC_ID,t),localStorage.setItem("SC_winsay_cp_custom__LS",t),(o=document.getElementById("SC_winsay_cp_custom__LS"))&&(o.value=t),localStorage.getItem("SC_winsay_cp_custom__defaultS_auto")){let e=`@import url("root-base-light.css"); @import url("${t}");`;fs&&fs.writeFile(`${window.siyuan.config.system.confDir}${config.S2_BASE}defaultS.css`,e,"utf-8",(function(e){}))}break}window.funs.updateStyle(config.IDs.STYLE_COLOR,`${config.S2_BASE}${t}`)}))}function iterLC(){let e=[],t=[],o=localStorage.getItem(config.latest_LC_ID);if(window.theme.iter=config.Iterator(e),o){t=config.colors,t.forEach((t=>e.push(`${t}`))),window.funs.updateStyle(config.IDs.STYLE_COLOR,`${config.S2_BASE}${o}`);for(let e=0;e<t.length&&window.theme.iter.next().value!==o;++e);}else new Promise((function(e){var t=new XMLHttpRequest;t.open("POST","http://127.0.0.1:6806/api/file/getFile",!0),t.setRequestHeader("Content-type","application/json");var o={path:config.config_UI};t.send(JSON.stringify(o)),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var o=t.responseText;e(JSON.parse(o))}}})).then((function(o){t=config.colors,t.forEach((t=>e.push(`${t}`))),window.theme.iter=config.Iterator(e),localStorage.setItem(config.latest_LC_ID,o.color.light),window.funs.updateStyle(config.IDs.STYLE_COLOR,`${config.S2_BASE}${o.color.light}`);for(let e=0;e<t.length&&window.theme.iter.next().value!==o.color.light;++e);}))}function iterDC(){let e=[],t=[],o=localStorage.getItem(config.latest_DC_ID);if(window.theme.iter=config.Iterator2(e),o){t=config.colors2,t.forEach((t=>e.push(`${t}`))),window.funs.updateStyle(config.IDs.STYLE_COLOR,`${config.S2_BASE}${o}`);for(let e=0;e<t.length&&window.theme.iter.next().value!==o;++e);}else new Promise((function(e){var t=new XMLHttpRequest;t.open("POST","http://127.0.0.1:6806/api/file/getFile",!0),t.setRequestHeader("Content-type","application/json");var o={path:config.config_UI};t.send(JSON.stringify(o)),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var o=t.responseText;e(JSON.parse(o))}}})).then((function(o){t=config.colors2,t.forEach((t=>e.push(`${t}`))),window.theme.iter=config.Iterator2(e),localStorage.setItem(config.latest_DC_ID,o.color.dark),window.funs.updateStyle(config.IDs.STYLE_COLOR,`${config.S2_BASE}${o.color.dark}`);for(let e=0;e<t.length&&window.theme.iter.next().value!==o.color.dark;++e);}))}function DesktopChangeColor(){const e=document.getElementById("drag");if(config.themeStyle){const t=document.createElement("button");t.id=config.IDs.BUTTON_TOOLBAR_CHANGE_COLOR,t.className="toolbar__item b3-tooltips b3-tooltips__sw",t.ariaLabel="形态切换（实验性）",t.innerHTML='<svg><use xlink:href="#iconTheme"></use></svg>',t.addEventListener("click",(e=>{const t=window.theme.iter.next().value;switch(window.funs.getThemeMode){case"dark":localStorage.setItem(config.latest_DC_ID,t),localStorage.setItem("SC_winsay_cp_custom__DS",t),(o=document.getElementById("SC_winsay_cp_custom__DS"))&&(o.value=t);break;case"light":default:var o;if(localStorage.setItem(config.latest_LC_ID,t),localStorage.setItem("SC_winsay_cp_custom__LS",t),(o=document.getElementById("SC_winsay_cp_custom__LS"))&&(o.value=t),localStorage.getItem("SC_winsay_cp_custom__defaultS_auto")){let e=`@import url("root-base-light.css"); @import url("${t}");`;fs&&fs.writeFile(`${window.siyuan.config.system.confDir}${config.S2_BASE}defaultS.css`,e,"utf-8",(function(e){}))}break}window.funs.updateStyle(config.IDs.STYLE_COLOR,`${config.S2_BASE}${t}`)})),null==document.getElementById(config.IDs.BUTTON_TOOLBAR_CHANGE_COLOR)&&e.insertAdjacentElement("afterend",t)}}async function changeStyleMod(){switch(window.funs.getThemeMode){case"dark":iterDC();break;case"light":default:iterLC();break}"body--mobile"==config.clientMode?(createAndroidSofillToolbar(),AndroidChangeColor()):DesktopChangeColor()}function changeThemeModeByApp(){let e=null;switch(window.funs.getThemeMode){case"light":e=`${config.S2_BASE}root-base-light.css`,config.colors2.forEach((e=>API.removejscssfile(`${config.S2_BASE}${e}`,"css"))),API.removejscssfile(`${config.S2_BASE}root-base-dark.css`,"css");break;case"dark":default:fs&&fs.writeFile(`${window.siyuan.config.system.confDir}${config.S2_BASE}defaultS.css`,"","utf-8",(function(e){})),e=`${config.S2_BASE}root-base-dark.css`,config.colors.forEach((e=>API.removejscssfile(`${config.S2_BASE}${e}`,"css"))),API.removejscssfile(`${config.S2_BASE}root-base-light.css`,"css");break}setTimeout((()=>{window.funs.updateStyle(config.ID_COLOR_STYLE,e)}),1e3),changeStyleMod()}"body--app"==config.clientMode&&(fs=require("fs")),changeThemeModeByApp();export{iterLC,iterDC};