import{ConfirmDialog,CPDialog}from"./module/CPM.js";import{ConfirmDialog1,ConfirmDialog2}from"./module/XML/ConfirmDialog.js";import*as API from"./utils/api.min.js";import*as config from"./config.js";if(API.isPhone()){const e=document.getElementById("sidebar");if(null==document.getElementById("Sofill-CDUI-1")){const t=document.createElement("svg");t.id="Sofill-CDUI-1",t.className="Sofill-CDUI-btn1 toolbar__icon",t.innerHTML='<use xlink:href="#iconSettings"></use>',t.style.width="17px",t.style.height="100%",t.style.marginLeft="5px",e.children[0].insertAdjacentElement("beforeend",t);let o=new CPDialog({isCancel:!0,dragable:!1,maskable:!0});document.querySelector(".Sofill-CDUI-btn1").onclick=function(){o.open()}}}else{const e=document.getElementById("barHelp");if(null==document.getElementById("Sofill-CDUI-1")){const t=document.createElement("button");t.id="Sofill-CDUI-1",t.className="Sofill-CDUI-btn1 b3-menu__item",t.ariaLabel="主题设置（实验性）",t.innerHTML='<svg class="b3-menu__icon" "=""><use xlink:href="#iconSettings"></use></svg><span class="b3-menu__label">主题设置</span>',e.children[1].insertAdjacentElement("afterbegin",t);let o=new CPDialog({isCancel:!0,dragable:!1,maskable:!0});document.querySelector(".Sofill-CDUI-btn1").onclick=function(){o.open();var e="0";new Promise((function(e){var t=new XMLHttpRequest;t.open("POST","http://127.0.0.1:6806/api/file/getFile",!0),t.setRequestHeader("Content-type","application/json");t.send(JSON.stringify({path:"/conf/appearance/themes/Sofill-/theme.json"})),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var o=t.responseText;e(JSON.parse(o))}}})).then((function(t){e=t.version,document.getElementById("sc-custom-container-placehold").children[0].innerHTML=`Sofill- v${e} CP`}))}}}var obj={};function bindDomWithObject(e){var t=document.getElementById(e.id),o=e.obj,n=e.prop,a=e.callback,l=e.type,r=e.updated;Object.defineProperty(o,n,{get:function(){return t.value},set:function(e){t.value=e,localStorage.setItem(n,e)},configurable:!0}),t.addEventListener(l,(function(){o[n]=o[n],"function"==typeof r&&r(o,n,t)})),"function"==typeof a&&a(e,o,t)}function propInit(e,t){bindDomWithObject({id:e,obj:obj,prop:e,type:t,callback:function(t,o,n){API.isEmpty(localStorage.getItem(e))||(o[t.prop]=localStorage.getItem(e))}})}function propChange(e,t){bindDomWithObject({id:e,obj:obj,prop:e,type:"change",updated:t}),t()}function checkedInit(e){"true"===localStorage.getItem(e.id)?e.checked=!0:e.checked=!1}function checkedChange(e,t,o){e.checked&&!0===e.checked?(localStorage.setItem(e.id,"true"),t()):(localStorage.setItem(e.id,"false"),o()),e.addEventListener("click",(function(){!0===e.checked?(localStorage.setItem(e.id,"true"),t()):(localStorage.setItem(e.id,"false"),o())}))}let selectList=document.querySelectorAll("select[id^='SC_winsay_cp']");selectList.forEach((function(e){propInit(e.id,"change")}));let rangeSliderList=document.querySelectorAll("input[id^='SC_winsay_cp'][type='range']");rangeSliderList.forEach((function(e){propInit(e.id,"change")}));let checkboxList=document.querySelectorAll("input[id^='SC_winsay_cp'][type='checkbox']");checkboxList.forEach((function(e){checkedInit(e)})),document.getElementById("SC_winsay_cp_system__ClearlocalStorage").addEventListener("click",(function(){new ConfirmDialog({isCancel:!0,dragable:!1,XML:ConfirmDialog1,success(){for(var e=0,t=0;t<localStorage.length;t++){((o=localStorage.key(t)).startsWith("winsay_")||o.startsWith("SC_winsay_"))&&(localStorage.removeItem(o),e++)}for(t=0;t<localStorage.length;t++){var o;((o=localStorage.key(t)).startsWith("winsay_")||o.startsWith("SC_winsay_"))&&(localStorage.removeItem(o),e++)}API.通知(`已清理 ${e} 项<br>页面即将刷新`),setTimeout((()=>{window.location.reload()}),3e3)},cancel(){},maskable:!0}).open()})),document.getElementById("SC_winsay_cp_system__ResetAllSettings").addEventListener("click",(function(){new ConfirmDialog({isCancel:!0,dragable:!1,XML:ConfirmDialog2,success(){for(var e=0,t=0;t<localStorage.length;t++){(o=localStorage.key(t)).startsWith("SC_winsay_cp")&&(localStorage.removeItem(o),e++)}for(t=0;t<localStorage.length;t++){var o;(o=localStorage.key(t)).startsWith("SC_winsay_cp")&&(localStorage.removeItem(o),e++)}API.通知(`已重置 ${e} 项<br>页面即将刷新`),setTimeout((()=>{window.location.reload()}),3e3)},cancel(){},maskable:!0}).open()})),propChange("SC_winsay_cp_appearance__TabBarMode",(function(){var e=localStorage.getItem("SC_winsay_cp_appearance__TabBarMode"),t=API.isEmpty(e)?"sweet/MI-TabBar-D.css":e;window.funs.updateStyle("TabBar",`/appearance/themes/Sofill-/style/${t}`)})),checkedChange(document.getElementById("SC_winsay_cp_appearance__ToolBarMode"),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-height-max","11px"),document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-child-visibility","hidden"),document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-svg-height","0px")}),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-height-max","37px"),document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-child-visibility","visible"),document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-svg-height","14px")})),propChange("SC_winsay_cp_appearance__ToolBarMode__height",(function(){var e=localStorage.getItem("SC_winsay_cp_appearance__ToolBarMode__height");API.isEmpty(e)||(document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-height",e),document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-svg-height",parseInt(e)/2+1+"px"),document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-svg-hover-height",parseInt(e)/2+1+"px"))})),propChange("SC_winsay_cp_appearance__ToolBarMode__NotFocus__bgColor",(function(){var e=localStorage.getItem("SC_winsay_cp_appearance__ToolBarMode__NotFocus__bgColor");API.isEmpty(e)||document.documentElement.style.setProperty("--b3-toolbar-background",e)}));var t=null,SC_winsay_cp_editor__DocWidthMode__previousValue="null";propChange("SC_winsay_cp_editor__DocWidthMode",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__DocWidthMode");clearInterval(t),API.isEmpty(e)?SC_winsay_cp_editor__DocWidthMode__previousValue!=e&&null!=e&&window.location.reload():(SC_winsay_cp_editor__DocWidthMode__previousValue=e,t=setInterval((function(){var t=document.querySelectorAll("#layouts .layout__center .protyle-wysiwyg.protyle-wysiwyg--attr"),o=document.querySelectorAll("#layouts .layout__center .protyle-title.protyle-wysiwyg--attr");t.forEach((function(t){t.style.setProperty("padding",e)})),o.forEach((function(t){t.style.setProperty("margin",e)}))}),1e3))})),checkedChange(document.getElementById("SC_winsay_cp_appearance__DockBgColorFilter"),(()=>{document.querySelector("#dockLeft").style.setProperty("background-image","linear-gradient(to top,#cccccc16,#ffffff06)"),document.querySelector("#dockRight").style.setProperty("background-image","linear-gradient(to top left,#cccccc16,#ffffff06)"),document.querySelector("#status").style.setProperty("background-image","linear-gradient(to top right,#cccccc16,#ffffff06)")}),(()=>{document.querySelector("#dockLeft").style.setProperty("background-image","none"),document.querySelector("#dockRight").style.setProperty("background-image","none"),document.querySelector("#status").style.setProperty("background-image","none")})),checkedChange(document.getElementById("SC_winsay_cp_appearance__ToolBarMode__HideList__docName"),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-docName-opacity","0")}),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-docName-opacity","0.77")})),checkedChange(document.getElementById("SC_winsay_cp_appearance__ToolBarMode__HideList__VIP"),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-VIP-opacity","0")}),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-VIP-opacity","0.77")})),checkedChange(document.getElementById("SC_winsay_cp_appearance__ToolBarMode__HideList__windowX"),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-windowX-opacity","0")}),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-windowX-opacity","0.77")})),checkedChange(document.getElementById("SC_winsay_cp_appearance__ToolBarMode__HideList__Other"),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-Other-opacity","0")}),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-ToolBar-Other-opacity","0.77")})),checkedChange(document.getElementById("SC_winsay_cp_editor__ListAutoIndent"),(()=>{document.documentElement.style.setProperty("--SCC-Variables-List-Item-margin","max(min(18px,0.88cqw),8px)"),document.documentElement.style.setProperty("--SCC-Variables-List-Item-padding","min(16px,0.58cqw)")}),(()=>{document.documentElement.style.setProperty("--SCC-Variables-List-Item-margin","18px"),document.documentElement.style.setProperty("--SCC-Variables-List-Item-padding","16px")})),propChange("SC_winsay_cp_editor__img-bg-color",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__img-bg-color");if(!API.isEmpty(e))switch(localStorage.getItem("SC_winsay_cp_editor__img-bg-color_always")){case"true":document.documentElement.style.setProperty("--SCC-Variables-IMG-bg-color_hover",e),document.documentElement.style.setProperty("--SCC-Variables-IMG-bg-color",e);break;default:document.documentElement.style.setProperty("--SCC-Variables-IMG-bg-color_hover",e),document.documentElement.style.setProperty("--SCC-Variables-IMG-bg-color","transparent")}})),checkedChange(document.getElementById("SC_winsay_cp_editor__img-bg-color_always"),(()=>{var e=localStorage.getItem("SC_winsay_cp_editor__img-bg-color");document.documentElement.style.setProperty("--SCC-Variables-IMG-bg-color_hover",e),document.documentElement.style.setProperty("--SCC-Variables-IMG-bg-color",e)}),(()=>{var e=localStorage.getItem("SC_winsay_cp_editor__img-bg-color");document.documentElement.style.setProperty("--SCC-Variables-IMG-bg-color_hover",e),document.documentElement.style.setProperty("--SCC-Variables-IMG-bg-color","transparent")})),checkedChange(document.getElementById("SC_winsay_cp_filetree__Hide_untitle"),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-DocTree-Untitle-opacity","0")}),(()=>{document.documentElement.style.setProperty("--SCC-Variables-MI-DocTree-Untitle-opacity","1")})),checkedChange(document.getElementById("SC_winsay_cp_editor__LH_Adaptive"),(()=>{window.funs.updateStyle("LH_Adaptive","/appearance/themes/Sofill-/style/sweet/LH-Adaptive.css")}),(()=>{API.removejscssfile(`${config.THEME_ROOT}style/sweet/LH-Adaptive.css`,"css")})),checkedChange(document.getElementById("SC_winsay_cp_editor__BreadcrumbsMode-Adaptive"),(()=>{window.funs.updateStyle("docBreadcrumb_Adaptive","/appearance/themes/Sofill-/style/sweet/MI-Breadcrumb-Adaptive.css")}),(()=>{API.removejscssfile(`${config.THEME_ROOT}style/sweet/MI-Breadcrumb-Adaptive.css`,"css")})),checkedChange(document.getElementById("SC_winsay_cp_editor__AreoBg-Filter"),(()=>{window.funs.updateStyle("AreoBg-Filter","/appearance/themes/Sofill-/style/sweet/AreoBg-Filter.css")}),(()=>{API.removejscssfile(`${config.THEME_ROOT}style/sweet/AreoBg-Filter.css`,"css")})),checkedChange(document.getElementById("SC_winsay_cp_appearance__ShowWebIcon"),(()=>{window.funs.updateStyle("ShowWebIcon","/appearance/themes/Sofill-/style/link/web.css")}),(()=>{API.removejscssfile(`${config.THEME_ROOT}style/link/web.css`,"css")})),checkedChange(document.getElementById("SC_winsay_cp_appearance__ShowFileIcon"),(()=>{window.funs.updateStyle("ShowFileIcon","/appearance/themes/Sofill-/style/link/file.css")}),(()=>{API.removejscssfile(`${config.THEME_ROOT}style/link/file.css`,"css")})),propChange("SC_winsay_cp_editor__Block-Inline-link__block-ref-content",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__Block-Inline-link__block-ref-content");if(!API.isEmpty(e)){var t=e.split(" ")[0],o=e.split(" ")[1];document.documentElement.style.setProperty("--SCC-Variables-Block-Inline-link__block-ref__before",`'${t}'`),document.documentElement.style.setProperty("--SCC-Variables-Block-Inline-link__block-ref__after",`'${o}'`)}})),propChange("SC_winsay_cp_editor__Block-List-Task__item-done__text-color",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__Block-List-Task__item-done__text-color");API.isEmpty(e)||"auto"!=e?(document.documentElement.style.setProperty("--SCC-Variables-Block-List-Task__item-done-color","var(--b3-theme-on-background)"),document.documentElement.style.setProperty("--SCC-Variables-Block-List-Task__item-done-backdrop-filter","none")):(document.documentElement.style.setProperty("--SCC-Variables-Block-List-Task__item-done-color","var(--b3-theme-secondary)"),document.documentElement.style.setProperty("--SCC-Variables-Block-List-Task__item-done-backdrop-filter","brightness(1.58) blur(13px)"))})),propChange("SC_winsay_cp_appearance__status_msg_opacity",(function(){var e=localStorage.getItem("SC_winsay_cp_appearance__status_msg_opacity");API.isEmpty(e)||document.documentElement.style.setProperty("--SCC-Variables-MI-status__msg_opacity",e)})),propChange("SC_winsay_cp_editor__LH_Adaptive__pIndent",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__pIndent");API.isEmpty(e)||(document.documentElement.style.setProperty("--SCC-Variables-MI-Doc-pIndent",`${API.RangeLimitedInt(-5,e,20)}rem`),document.getElementById("SC_winsay_cp_editor__LH_Adaptive__pIndent").value=API.RangeLimitedInt(-5,e,20))})),propChange("SC_winsay_cp_editor__LH_Adaptive__LH",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__LH");API.isEmpty(e)||(document.documentElement.style.setProperty("--SCC-Variables-MI-Doc-LH",`${e}`),document.getElementById("SC_winsay_cp_editor__LH_Adaptive__LH__label").setAttribute("aria-label",`${e}`),localStorage.setItem("SC_winsay_cp_editor__LH_Adaptive__LH__label",e))})),propChange("SC_winsay_cp_editor__LH_Adaptive__marginTop",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__marginTop");API.isEmpty(e)||(document.documentElement.style.setProperty("--SCC-Variables-MI-Doc-marginTop",API.RangeLimitedInt(100,e,500)/100+"rem"),document.getElementById("SC_winsay_cp_editor__LH_Adaptive__marginTop").value=API.RangeLimitedInt(100,e,500))})),propChange("SC_winsay_cp_editor__LH_Adaptive__marginBottom",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__marginBottom");API.isEmpty(e)||(document.documentElement.style.setProperty("--SCC-Variables-MI-Doc-marginBottom",API.RangeLimitedInt(100,e,500)/100+"rem"),document.getElementById("SC_winsay_cp_editor__LH_Adaptive__marginBottom").value=API.RangeLimitedInt(100,e,500))})),propChange("SC_winsay_cp_editor__LH_Adaptive__lSpacing",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__lSpacing");API.isEmpty(e)||(document.documentElement.style.setProperty("--SCC-Variables-MI-Doc-lSpacing",`${e}rem`),document.getElementById("SC_winsay_cp_editor__LH_Adaptive__lSpacing__label").setAttribute("aria-label",`${e}`),localStorage.setItem("SC_winsay_cp_editor__LH_Adaptive__lSpacing__label",e))})),propChange("SC_winsay_cp_editor__BlockScrollBar-opacity",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__BlockScrollBar-opacity");if(!API.isEmpty(e))switch(document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-opacity-hover",e),e){case"0.58":document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-opacity","0.58");break;default:document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-opacity","0");break}})),propChange("SC_winsay_cp_editor__BlockScrollBar_Hposition",(function(){var e=localStorage.getItem("SC_winsay_cp_editor__BlockScrollBar_Hposition");if(!API.isEmpty(e))switch(e){case"L31":document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-right","unset"),document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-left","31px"),document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-tooltips-top","-100%");break;case"L13":document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-right","unset"),document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-left","13px"),document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-tooltips-top","-100%");break;case"R31":document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-right","31px"),document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-left","unset"),document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-tooltips-top","100%");break;case"R13":default:document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-right","13px"),document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-left","unset"),document.documentElement.style.setProperty("--SCC-Variables-MI-BlockScrollBar-tooltips-top","100%");break}})),checkedChange(document.getElementById("SC_winsay_cp_filetree__Adaptive_display"),(()=>{window.funs.updateStyle("MI-DocTree-Adaptive","/appearance/themes/Sofill-/style/sweet/MI-DocTree-Adaptive.css")}),(()=>{API.removejscssfile(`${config.THEME_ROOT}style/sweet/MI-DocTree-Adaptive.css`,"css")})),propChange("SC_winsay_cp_filetree__docFontsize",(function(){var e=localStorage.getItem("SC_winsay_cp_filetree__docFontsize");API.isEmpty(e)||(document.documentElement.style.setProperty("--SCC-Variables-MI-DocTree-docFontsize",`${e}pt`),document.getElementById("SC_winsay_cp_filetree__docFontsize__label").setAttribute("aria-label",`${e}`),localStorage.setItem("SC_winsay_cp_filetree__docFontsize__label",e))})),propChange("SC_winsay_cp_filetree__nbFontsize",(function(){var e=localStorage.getItem("SC_winsay_cp_filetree__nbFontsize");API.isEmpty(e)||(document.documentElement.style.setProperty("--SCC-Variables-MI-DocTree-nbFontsize",`${e}pt`),document.getElementById("SC_winsay_cp_filetree__nbFontsize__label").setAttribute("aria-label",`${e}`),localStorage.setItem("SC_winsay_cp_filetree__nbFontsize__label",e))})),propChange("SC_winsay_cp_filetree__nbMargin",(function(){var e=localStorage.getItem("SC_winsay_cp_filetree__nbMargin");API.isEmpty(e)||(document.documentElement.style.setProperty("--SCC-Variables-MI-DocTree-nbMargin",`${e}em`),document.getElementById("SC_winsay_cp_filetree__nbMargin__label").setAttribute("aria-label",`${e}`),localStorage.setItem("SC_winsay_cp_filetree__nbMargin__label",e))})),checkedChange(document.getElementById("SC_winsay_cp_editor__FocusEnhanc_inlineCode"),(()=>{document.documentElement.style.setProperty("--SCC-Variables-Block-Inline-span__code__before-content","'<'"),document.documentElement.style.setProperty("--SCC-Variables-Block-Inline-span__code__after-content","'>'")}),(()=>{document.documentElement.style.setProperty("--SCC-Variables-Block-Inline-span__code__before-content",""),document.documentElement.style.setProperty("--SCC-Variables-Block-Inline-span__code__after-content","")}));