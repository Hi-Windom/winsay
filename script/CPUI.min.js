import { ConfirmDialog, CPDialog } from "./module/CPM.js";
import { ConfirmDialog1,ConfirmDialog2 } from "./module/XML/ConfirmDialog.js";
import * as API from "./utils/api.min.js";
import * as config from "./config.js";

if (API.isPhone()) {
  const leftPanel = document.getElementById("sidebar");
  if (document.getElementById("Sofill-CDUI-1") == null) {
    const CDUI_1 = document.createElement("svg");
    CDUI_1.id = "Sofill-CDUI-1";
    CDUI_1.className = "Sofill-CDUI-btn toolbar__icon";
    CDUI_1.innerHTML = `<use xlink:href="#iconSettings"></use>`;
    CDUI_1.style.width = "17px";
    CDUI_1.style.height = "100%";
    CDUI_1.style.marginLeft = "5px";
    leftPanel.children[0].insertAdjacentElement("beforeend", CDUI_1);
    let dialog = new CPDialog({
      isCancel: true,
      dragable: false, //貌似可拖拽会有问题
      maskable: true,
    });
    document.querySelector("#Sofill-CDUI-1").onclick = function () {
      dialog.open();
    };
  }
} else {
  const barHelp = document.getElementById("barHelp");
  if (document.getElementById("Sofill-CDUI-1") == null) {
    const CDUI_1 = document.createElement("button");
    CDUI_1.id = "Sofill-CDUI-1";
    CDUI_1.className = "Sofill-CDUI-btn b3-menu__item";
    CDUI_1.ariaLabel = "主题设置（实验性）";
    CDUI_1.innerHTML = `<svg class="b3-menu__icon Sofill-CDUI-btn__icon" "=""><use xlink:href="#iconSettings"></use></svg><span class="b3-menu__label">主题设置</span>`;
    barHelp.children[1].insertAdjacentElement("beforeend", CDUI_1);
    let dialog = new CPDialog({
      isCancel: true,
      dragable: false, //貌似可拖拽会有问题
      maskable: true,
    });
    document.querySelector("#Sofill-CDUI-1").onclick = function () {
      dialog.open();
      var version = "0";
      new Promise(function (response) {
        var url = `http://127.0.0.1:6806/api/file/getFile`;
        var httpRequest = new XMLHttpRequest();
        httpRequest.open("POST", url, true);
        httpRequest.setRequestHeader("Content-type", "application/json");
        var obj = {
          path: "/conf/appearance/themes/Sofill-/theme.json",
        };
        httpRequest.send(JSON.stringify(obj));
        // 响应后的回调函数
        httpRequest.onreadystatechange = function () {
          if (httpRequest.readyState == 4 && httpRequest.status == 200) {
            var json = httpRequest.responseText;
            console.log(json);
            response(JSON.parse(json));
          }
        };
      }).then(function (response) {
        version = response.version;
        document.getElementById(
          "sc-custom-container-placehold"
        ).children[0].innerHTML = `Sofill- v${version} CP`;
        document.getElementById("SC_winsay_cp_version").innerHTML = `当前版本 v${version}
        <div class="b3-label__text"><a href="https://gitee.com/soltus/Sofill/blob/main/CHANGELOG/winsay.md" target="_blank">浏览更新历史</a></div>`;
      });
    };
  }
}

var obj = {};

function bindDomWithObject(options) {
  var dom = document.getElementById(options.id); // 获取dom id
  var obj = options.obj; // 需要绑定的obj
  var prop = options.prop; // 需要绑定的obj 的属性
  var callback = options.callback; // 绑定成功后调用
  var type = options.type; // 绑定的事件类型
  var updated = options.updated; // 更新成功后调用

  Object.defineProperty(obj, prop, {
    get: function () {
      return dom.value;
    },
    set: function (value) {
      dom.value = value;
      localStorage.setItem(prop, value);
    },
    configurable: true,
  });

  dom.addEventListener(type, function () {
    obj[prop] = obj[prop];
    if (typeof updated === "function") {
      updated(obj, prop, dom); // 传入对象， 修改的属性， 以及dom节点
    }
  });

  if (typeof callback === "function") {
    callback(options, obj, dom);
  }
}

function propInit(id, type) {
  bindDomWithObject({
    id: id,
    obj: obj,
    prop: id,
    type: type,
    callback: function (options, obj, dom) {
      if (!API.isEmpty(localStorage.getItem(id))) {
        obj[options.prop] = localStorage.getItem(id);
      }
    },
  });
  console.log(`${id} binded successfully`);
}

function propChange(id, changeFn) {
  bindDomWithObject({
    id: id,
    obj: obj,
    prop: id,
    type: "change",
    updated: changeFn,
  });
  changeFn();
}

function checkedInit(obj) {
  if (localStorage.getItem(obj.id) === "true") {
    obj.checked = true;
  } else {
    obj.checked = false;
  }
  console.log(`${obj.id} binded successfully`);
}

function checkedChange(obj, YesFn, NoFn) {
  if (obj.checked && obj.checked === true) {
    localStorage.setItem(obj.id, "true");
    YesFn();
  } else {
    localStorage.setItem(obj.id, "false");
    NoFn();
  }
  obj.addEventListener("click", function () {
    if (obj.checked === true) {
      localStorage.setItem(obj.id, "true");
      YesFn();
    } else {
      localStorage.setItem(obj.id, "false");
      NoFn();
    }
  });
}

// 初始化选项的值
let selectList = document.querySelectorAll("select[id^='SC_winsay_cp']");
// console.log(selectList);
selectList.forEach(function (value) {
  propInit(value.id, "change");
});
let rangeSliderList = document.querySelectorAll(
  "input[id^='SC_winsay_cp'][type='range']"
);
// console.log(rangeSliderList);
rangeSliderList.forEach(function (value) {
  propInit(value.id, "change");
});
let checkboxList = document.querySelectorAll(
  "input[id^='SC_winsay_cp'][type='checkbox']"
);
// console.log(checkboxList);
checkboxList.forEach(function (value) {
  checkedInit(value);
});
// 支持记忆主题设置界面 #499
let navLatest = localStorage.getItem("SC_winsay_cp_custom-nav-bind-id");
if (!API.isEmpty(navLatest)) {
  document.getElementById(navLatest).checked = "true";
}
let navList = document.querySelectorAll(
  "input[id^='sc-custom-nav-bind-id'][type='radio']"
);
navList.forEach(function (value) {
  checkedChange(value,()=>{localStorage.setItem("SC_winsay_cp_custom-nav-bind-id",value.id);},()=>{});
});

// 按钮监听事件
document
  .getElementById("SC_winsay_cp_system__ClearlocalStorage")
  .addEventListener("click", function () {
    let clearAll = new ConfirmDialog({
      isCancel: true,
      dragable: false,
      XML: ConfirmDialog1,
      success() {
        console.log("点击了确定");
        var counter = 0;
        for (var i = 0; i < localStorage.length; i++) {
          var key = localStorage.key(i);
          if (key.startsWith("winsay_") || key.startsWith("SC_winsay_")) {
            localStorage.removeItem(key);
            console.log(`${key} removed`);
            counter++;
          }
        }
        // 简单粗暴的执行两次
        for (var i = 0; i < localStorage.length; i++) {
          var key = localStorage.key(i);
          if (key.startsWith("winsay_") || key.startsWith("SC_winsay_")) {
            localStorage.removeItem(key);
            console.log(`${key} removed`);
            counter++;
          }
        }
        API.通知(`已清理 ${counter} 项<br>页面即将刷新`);
        setTimeout(() => {
          window.location.reload();
        }, 3000);
      },
      cancel() {
        console.log("点击了取消");
      },
      maskable: true,
    });

    clearAll.open();
  });

document
  .getElementById("SC_winsay_cp_system__ResetAllSettings")
  .addEventListener("click", function () {
    let clearAll = new ConfirmDialog({
      isCancel: true,
      dragable: false,
      XML: ConfirmDialog2,
      success() {
        console.log("点击了确定");
        var counter = 0;
        for (var i = 0; i < localStorage.length; i++) {
          var key = localStorage.key(i);
          if (key.startsWith("SC_winsay_cp")) {
            localStorage.removeItem(key);
            console.log(`${key} removed`);
            counter++;
          }
        }
        // 简单粗暴的执行两次
        for (var i = 0; i < localStorage.length; i++) {
          var key = localStorage.key(i);
          if (key.startsWith("SC_winsay_cp")) {
            localStorage.removeItem(key);
            console.log(`${key} removed`);
            counter++;
          }
        }
        API.通知(`已重置 ${counter} 项<br>页面即将刷新`);
        setTimeout(() => {
          window.location.reload();
        }, 3000);
      },
      cancel() {
        console.log("点击了取消");
      },
      maskable: true,
    });

    clearAll.open();
  });

// 选项改变时的业务处理
propChange("SC_winsay_cp_appearance__TabBarMode", function () {
  var i = localStorage.getItem("SC_winsay_cp_appearance__TabBarMode");
  var j = API.isEmpty(i) ? "sweet/MI-TabBar-D.css" : i;
  window.funs.updateStyle("TabBar", `/appearance/themes/Sofill-/style/${j}`);
});
propChange("SC_winsay_cp_search__layout", function () {
  var i = localStorage.getItem("SC_winsay_cp_search__layout");
  var j = API.isEmpty(i) ? "layout-Auto.css" : i;
  window.funs.updateStyle("search__layout", `/appearance/themes/Sofill-/style/sweet/sugar/search/${j}`);
});
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__ToolBarMode"),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-height-max",
      "11px"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-child-visibility",
      "hidden"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-svg-height",
      `0px`
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-height-max",
      "37px"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-child-visibility",
      "visible"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-svg-height",
      `14px`
    );
  }
);
propChange("SC_winsay_cp_appearance__ToolBarMode__height", function () {
  var h = localStorage.getItem("SC_winsay_cp_appearance__ToolBarMode__height");
  if (!API.isEmpty(h)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-height",
      h
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-svg-height",
      `${parseInt(h) / 2 + 1}px`
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-svg-hover-height",
      `${parseInt(h) / 2 + 1}px`
    );
  }
});
propChange(
  "SC_winsay_cp_appearance__ToolBarMode__NotFocus__bgColor",
  function () {
    var h = localStorage.getItem(
      "SC_winsay_cp_appearance__ToolBarMode__NotFocus__bgColor"
    );
    if (!API.isEmpty(h)) {
      document.documentElement.style.setProperty("--b3-toolbar-background", h);
    }
  }
);
var t = null; // 声明计时器
var SC_winsay_cp_editor__DocWidthMode__previousValue = "null";
propChange("SC_winsay_cp_editor__DocWidthMode", function () {
  var w = localStorage.getItem("SC_winsay_cp_editor__DocWidthMode");
  clearInterval(t);
  if (!API.isEmpty(w)) {
    SC_winsay_cp_editor__DocWidthMode__previousValue = w;
    t = setInterval(function () {
      var node1 = document.querySelectorAll(
        "#layouts .layout__center .protyle-wysiwyg.protyle-wysiwyg--attr"
      );
      var node2 = document.querySelectorAll(
        "#layouts .layout__center .protyle-title.protyle-wysiwyg--attr"
      );
      node1.forEach(function (item) {
        item.style.setProperty("padding", w);
      });
      node2.forEach(function (item) {
        item.style.setProperty("margin", w);
      });
    }, 1000);
  } else if (
    SC_winsay_cp_editor__DocWidthMode__previousValue != w &&
    w != null
  ) {
    window.location.reload();
  }
});
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__DockBgColorFilter"),
  () => {
    document
      .querySelector("#dockLeft")
      .style.setProperty(
        "background-image",
        "linear-gradient(to top,#cccccc16,#ffffff06)"
      );
    document
      .querySelector("#dockRight")
      .style.setProperty(
        "background-image",
        "linear-gradient(to top left,#cccccc16,#ffffff06)"
      );
    document
      .querySelector("#status")
      .style.setProperty(
        "background-image",
        "linear-gradient(to top right,#cccccc16,#ffffff06)"
      );
  },
  () => {
    document
      .querySelector("#dockLeft")
      .style.setProperty("background-image", "none");
    document
      .querySelector("#dockRight")
      .style.setProperty("background-image", "none");
    document
      .querySelector("#status")
      .style.setProperty("background-image", "none");
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__ToolBarMode__HideList__docName"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-docName-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-docName-opacity",
      "0.77"
    );
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__ToolBarMode__HideList__VIP"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-VIP-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-VIP-opacity",
      "0.77"
    );
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__ToolBarMode__HideList__windowX"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-windowX-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-windowX-opacity",
      "0.77"
    );
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__ToolBarMode__HideList__Other"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-Other-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-Other-opacity",
      "0.77"
    );
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_editor__ListAutoIndent"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-margin",
      "max(min(18px,0.88cqw),8px)"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-padding",
      "min(16px,0.58cqw)"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-margin",
      "18px"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-padding",
      "16px"
    );
  }
);
propChange("SC_winsay_cp_editor__img-bg-color", function () {
  var value = localStorage.getItem("SC_winsay_cp_editor__img-bg-color");
  if (!API.isEmpty(value)) {
    switch(localStorage.getItem("SC_winsay_cp_editor__img-bg-color_always")) {
      case "true":
        document.documentElement.style.setProperty(
          "--SCC-Variables-IMG-bg-color_hover",
          value
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-IMG-bg-color",
          value
        );
        break;
      default:
        document.documentElement.style.setProperty(
          "--SCC-Variables-IMG-bg-color_hover",
          value
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-IMG-bg-color",
          "transparent"
        );
    }
  }
});
checkedChange(
  document.getElementById(
    "SC_winsay_cp_editor__img-bg-color_always"
  ),
  () => {
    var value = localStorage.getItem("SC_winsay_cp_editor__img-bg-color");
    document.documentElement.style.setProperty(
      "--SCC-Variables-IMG-bg-color_hover",
      value
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-IMG-bg-color",
      value
    );
  },
  () => {
    var value = localStorage.getItem("SC_winsay_cp_editor__img-bg-color");
    document.documentElement.style.setProperty(
      "--SCC-Variables-IMG-bg-color_hover",
      value
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-IMG-bg-color",
      "transparent"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_filetree__Hide_untitle"),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-Untitle-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-Untitle-opacity",
      "1"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_search__index"),
  () => {
    window.funs.updateStyle(
      "search__index",
      `/appearance/themes/Sofill-/style/sweet/sugar/search/index.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/sugar/search/index.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_editor__HintHint-index"),
  () => {
    window.funs.updateStyle(
      "HintHint-index",
      `/appearance/themes/Sofill-/style/sweet/sugar/editor/HintHint-index.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/sugar/editor/HintHint-index.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_editor__LH_Adaptive"),
  () => {
    window.funs.updateStyle(
      "LH_Adaptive",
      `/appearance/themes/Sofill-/style/sweet/LH-Adaptive.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/LH-Adaptive.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_editor__BreadcrumbsMode-Adaptive"),
  () => {
    window.funs.updateStyle(
      "docBreadcrumb_Adaptive",
      `/appearance/themes/Sofill-/style/sweet/MI-Breadcrumb-Adaptive.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/MI-Breadcrumb-Adaptive.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_editor__AreoBg-Filter"),
  () => {
    window.funs.updateStyle(
      "AreoBg-Filter",
      `/appearance/themes/Sofill-/style/sweet/AreoBg-Filter.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/AreoBg-Filter.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__ShowWebIcon"),
  () => {
    window.funs.updateStyle(
      "ShowWebIcon",
      `/appearance/themes/Sofill-/style/link/web.css`
    );
  },
  () => {
    API.removejscssfile(`${config.THEME_ROOT}style/link/web.css`, "css");
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__ShowFileIcon"),
  () => {
    window.funs.updateStyle(
      "ShowFileIcon",
      `/appearance/themes/Sofill-/style/link/file.css`
    );
  },
  () => {
    API.removejscssfile(`${config.THEME_ROOT}style/link/file.css`, "css");
  }
);
propChange("SC_winsay_cp_editor__Block-Inline-link__block-ref-content", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__Block-Inline-link__block-ref-content");
  if (!API.isEmpty(i)) {
    var before = i.split(" ")[0];
    var after = i.split(" ")[1];
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-Inline-link__block-ref__before",
      `'${before}'`
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-Inline-link__block-ref__after",
      `'${after}'`
    );
  }
});
propChange("SC_winsay_cp_editor__Block-List-Task__item-done__text-color", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__Block-List-Task__item-done__text-color");
  if (!API.isEmpty(i) && i == "auto") {
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-List-Task__item-done-color",
      "var(--b3-theme-secondary)"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-List-Task__item-done-backdrop-filter",
      "brightness(1.58) blur(13px)"
    );
  } else {
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-List-Task__item-done-color",
      "var(--b3-theme-on-background)"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-List-Task__item-done-backdrop-filter",
      "none"
    );
  }
});
propChange("SC_winsay_cp_appearance__status_msg_opacity", function () {
  var i = localStorage.getItem("SC_winsay_cp_appearance__status_msg_opacity");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-status__msg_opacity",
      i
    );
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__pIndent", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__pIndent");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-pIndent",
      `${API.RangeLimitedInt(-5, i, 20)}rem`
    );
    document.getElementById("SC_winsay_cp_editor__LH_Adaptive__pIndent").value =
      API.RangeLimitedInt(-5, i, 20);
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__LH", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__LH");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-LH",
      `${i}`
    );
    document
      .getElementById("SC_winsay_cp_editor__LH_Adaptive__LH__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem("SC_winsay_cp_editor__LH_Adaptive__LH__label", i);
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__marginTop", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__marginTop");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-marginTop",
      `${API.RangeLimitedInt(100, i, 500) / 100}rem`
    );
    document.getElementById(
      "SC_winsay_cp_editor__LH_Adaptive__marginTop"
    ).value = API.RangeLimitedInt(100, i, 500);
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__marginBottom", function () {
  var i = localStorage.getItem(
    "SC_winsay_cp_editor__LH_Adaptive__marginBottom"
  );
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-marginBottom",
      `${API.RangeLimitedInt(100, i, 500) / 100}rem`
    );
    document.getElementById(
      "SC_winsay_cp_editor__LH_Adaptive__marginBottom"
    ).value = API.RangeLimitedInt(100, i, 500);
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__lSpacing", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__lSpacing");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-lSpacing",
      `${i}rem`
    );
    document
      .getElementById("SC_winsay_cp_editor__LH_Adaptive__lSpacing__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem(
      "SC_winsay_cp_editor__LH_Adaptive__lSpacing__label",
      i
    );
  }
});
propChange("SC_winsay_cp_editor__BlockScrollBar-opacity", function () {
  var o = localStorage.getItem("SC_winsay_cp_editor__BlockScrollBar-opacity");
  if (!API.isEmpty(o)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-BlockScrollBar-opacity-hover",
      o
    );
    switch (o) {
      case "0.58":
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-opacity",
          "0.58"
        );
        break;
      default:
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-opacity",
          "0"
        );
        break;
    }
  }
});
propChange("SC_winsay_cp_editor__BlockScrollBar_Hposition", function () {
  var p = localStorage.getItem("SC_winsay_cp_editor__BlockScrollBar_Hposition");
  if (!API.isEmpty(p)) {
    switch (p) {
      case "L31":
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-right",
          "unset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-left",
          "31px"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-tooltips-top",
          "-100%"
        );
        break;
      case "L13":
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-right",
          "unset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-left",
          "13px"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-tooltips-top",
          "-100%"
        );
        break;
      case "R31":
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-right",
          "31px"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-left",
          "unset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-tooltips-top",
          "100%"
        );
        break;
      case "R13":
      default:
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-right",
          "13px"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-left",
          "unset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-tooltips-top",
          "100%"
        );
        break;
    }
  }
});
checkedChange(
  document.getElementById("SC_winsay_cp_filetree__Adaptive_display"),
  () => {
    window.funs.updateStyle(
      "MI-DocTree-Adaptive",
      `/appearance/themes/Sofill-/style/sweet/MI-DocTree-Adaptive.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/MI-DocTree-Adaptive.css`,
      "css"
    );
  }
);
propChange("SC_winsay_cp_filetree__docFontsize", function () {
  var i = localStorage.getItem("SC_winsay_cp_filetree__docFontsize");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-docFontsize",
      `${i}pt`
    );
    document
      .getElementById("SC_winsay_cp_filetree__docFontsize__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem("SC_winsay_cp_filetree__docFontsize__label", i);
  }
});
propChange("SC_winsay_cp_filetree__nbFontsize", function () {
  var i = localStorage.getItem("SC_winsay_cp_filetree__nbFontsize");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-nbFontsize",
      `${i}pt`
    );
    document
      .getElementById("SC_winsay_cp_filetree__nbFontsize__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem("SC_winsay_cp_filetree__nbFontsize__label", i);
  }
});
propChange("SC_winsay_cp_filetree__nbMargin", function () {
  var i = localStorage.getItem("SC_winsay_cp_filetree__nbMargin");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-nbMargin",
      `${i}em`
    );
    document
      .getElementById("SC_winsay_cp_filetree__nbMargin__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem("SC_winsay_cp_filetree__nbMargin__label", i);
  }
});
checkedChange(
  document.getElementById("SC_winsay_cp_editor__FocusEnhanc_inlineCode"),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-Inline-span__code__before-content",
      "'<'"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-Inline-span__code__after-content",
      "'>'"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-Inline-span__code__before-content",
      ""
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-Inline-span__code__after-content",
      ""
    );
  }
);
