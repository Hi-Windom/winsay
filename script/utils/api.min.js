import*as config from"./../config.js";export{insertCreateAfter,addinsertCreateElement,getTextWidth,removejscssfile,insertCreateBefore,getBlockSelected,compareVersion,isEmpty,RangeLimitedInt,MoveDOM,MoveChildren,CopyDOM,isAppMode,向思源请求数据 as request,交互业务 as transactions,以sql向思源请求块数据 as sql,获取思源块链接锚文本 as getAnchor,新建思源笔记本 as createNotebook,删除思源笔记本 as removeNotebook,保存思源笔记本配置 as setNotebookConf,获取思源笔记本配置 as getNotebookConf,打开思源笔记本 as openNotebook,关闭思源笔记本 as closeNotebook,重命名思源笔记本 as renameNotebook,通过markdown创建文档 as createDocWithMd,删除思源文档 as removeDoc,重命名思源文档 as renameDoc,移动思源文档 as moveDoc,以id获取文档内容 as getDoc,以id获取文档块markdown as exportMdContent,以id获取文档大纲 as getDocOutline,以id获取思源块属性 as getBlockAttrs,设置思源块属性 as setBlockAttrs,根据思源路径获取人类可读路径 as getHPathByPath,根据块ID查询文档人类可读完整路径 as getHPathByID,列出指定路径下文档 as listDocsByPath,以id获取反向链接 as getBacklink,以sql获取嵌入块内容 as searchEmbedBlock,获取标签列表 as getTag,导出模板 as docSaveAsTemplate,渲染模板 as render,以id获取局部图谱 as getLocalGraph,获取全局图谱 as getGraph,以关键词搜索文档 as searchDocs,以关键词搜索块 as searchBlock,以关键词搜索模板 as searchTemplate,插入块 as insertBlock,插入前置子块 as prependBlock,插入后置子块 as appendBlock,删除块 as deleteBlock,更新块 as updateBlock,以id获取思源块信息 as getBlockByID,获取块kramdown源码 as getBlockKramdown,获取块面包屑 as getBlockBreadcrumb,获取系统字体列表 as getSysFonts,获取文件 as getFile,写入文件 as putFile,推送消息 as pushMsg,推送报错消息 as pushErrMsg,通知};async function 向思源请求数据(e,t){let n=null;return await fetch(e,{body:JSON.stringify(t),method:"POST",headers:{Authorization:`Token '${window.siyuan.config.api.token}'`}}).then((function(e){n=e.json()})),n}async function 解析响应体(e){let t=await e;return 0===t.code?t.data:null}async function 交互业务(e,t=[]){const n=new URL(e.ws.ws.url);return 解析响应体(向思源请求数据("/api/transactions",{app:n.searchParams.get("app"),session:n.searchParams.get("id"),transactions:t}))}async function 以sql向思源请求块数据(e){return 解析响应体(向思源请求数据("/api/query/sql",{stmt:e}))}async function 获取思源块链接锚文本(e){let t=`select * from blocks where id = '${e=e.replace("((","").replace("))","")}'`,n=await 以sql向思源请求块数据(t),o="";if(n)try{o=n[0][name]?n[0][name]:n[0].content?n[0].content:e}catch(e){o="解析错误"}return o}async function 打开思源笔记本(e){return 解析响应体(向思源请求数据("/api/notebook/openNotebook",{notebook:e}))}async function 关闭思源笔记本(e){return 解析响应体(向思源请求数据("/api/notebook/closeNotebook",{notebook:e}))}async function 重命名思源笔记本(e,t){return 解析响应体(向思源请求数据("/api/notebook/renameNotebook",{notebook:e,name:t}))}async function 新建思源笔记本(e){return 解析响应体(向思源请求数据("/api/notebook/createNotebook",{name:e}))}async function 删除思源笔记本(e){return 解析响应体(向思源请求数据("/api/notebook/removeNotebook",{notebook:e}))}async function 获取思源笔记本配置(e){return 解析响应体(向思源请求数据("/api/notebook/getNotebookConf",{notebook:e}))}async function 保存思源笔记本配置(e){return 解析响应体(向思源请求数据("/api/notebook/setNotebookConf",{notebook:e}))}async function 重命名思源文档(e,t,n){return 解析响应体(向思源请求数据("/api/filetree/renameDoc",{notebook:e,path:t,title:n}))}async function 删除思源文档(e,t){return 解析响应体(向思源请求数据("/api/filetree/removeDoc",{notebook:e,path:t}))}async function 移动思源文档(e,t,n,o){return 解析响应体(向思源请求数据("/api/filetree/moveDoc",{fromNotebook:e,fromPath:t,toNotebook:n,toPath:o}))}async function 根据思源路径获取人类可读路径(e,t){return 解析响应体(向思源请求数据("/api/filetree/getHPathByPath",{Notebook:e,Path:t}))}async function 根据块ID查询文档人类可读完整路径(e){return 解析响应体(向思源请求数据("/api/filetree/getHPathByID",{id:e}))}async function 以id获取思源块属性(e){return 解析响应体(向思源请求数据("/api/attr/getBlockAttrs",{id:e}))}async function 以id获取思源块信息(e){let t=`select * from blocks where id ='${e}'`;return(await 以sql向思源请求块数据(t))[0]}async function 获取块kramdown源码(e){return 解析响应体(向思源请求数据("/api/block/getBlockKramdown",{id:e}))}async function 获取块面包屑(e){return 解析响应体(向思源请求数据("/api/block/getBlockBreadcrumb",{id:e}))}async function 设置思源块属性(e,t){return 解析响应体(向思源请求数据("/api/attr/setBlockAttrs",{id:e,attrs:t}))}async function 以id获取文档块markdown(e){return 解析响应体(向思源请求数据("/api/export/exportMdContent",{id:e}))}async function 以id获取文档大纲(e){return 解析响应体(向思源请求数据("/api/outline/getDocOutline",{id:e}))}async function 列出指定路径下文档(e){return 解析响应体(向思源请求数据("/api/filetree/listDocsByPath",{path:e}))}function html转义(e){var t=document.createElement("div");t.innerHTML=e;var n=t.innerText||t.textContent;return t=null,n}async function 以id获取反向链接(e){return 解析响应体(向思源请求数据("/api/ref/getBacklink",{id:e,beforeLen:10,k:"",mk:""}))}async function 以sql获取嵌入块内容(e,t){return 解析响应体(向思源请求数据("/api/search/searchEmbedBlock",{stmt:t,excludeIDs:e}))}async function 以id获取文档内容(e){return 解析响应体(向思源请求数据("/api/filetree/getDoc",{id:e,k:"",mode:2,size:36}))}async function 获取标签列表(){return 解析响应体(向思源请求数据("/api/tag/getTag",{}))}async function 以id获取局部图谱(e,t,n,o){return 解析响应体(向思源请求数据("/api/graph/getLocalGraph",{id:t,k:e,conf:n,reqId:o}))}async function 获取全局图谱(e,t,n){return 解析响应体(向思源请求数据("/api/graph/getGraph",{k:e,conf:t,reqId:n}))}async function 以关键词搜索文档(e){return 解析响应体(向思源请求数据("/api/filetree/searchDocs",{k:e}))}async function 以关键词搜索块(e){return 解析响应体(向思源请求数据("/api/search/searchBlock",{query:e}))}async function 以关键词搜索模板(e){return 解析响应体(向思源请求数据("/api/search/searchTemplate",{k:e}))}async function 通过markdown创建文档(e,t,n){return 解析响应体(向思源请求数据("/api/filetree/createDocWithMd",{notebook:e,path:t,markdown:n}))}async function 导出模板(e,t=!1){return 解析响应体(向思源请求数据("/api/template/docSaveAsTemplate",{id:e,overwrite:t}))}async function 渲染模板(e){return 解析响应体(向思源请求数据("/api/template/render",e))}async function 插入块(e,t,n){let o="/api/block/insertBlock";return 解析响应体(向思源请求数据(o=o,n={previousID:e,dataType:t,data:n}))}async function 插入前置子块(e,t,n){let o="/api/block/prependBlock";return 解析响应体(向思源请求数据(o=o,n={parentID:e,dataType:t,data:n}))}async function 插入后置子块(e,t,n){let o="/api/block/appendBlock";return 解析响应体(向思源请求数据(o=o,n={parentID:e,dataType:t,data:n}))}async function 更新块(e,t,n){let o="/api/block/updateBlock";return 解析响应体(向思源请求数据(o=o,n={id:e,dataType:t,data:n}))}async function 删除块(e){let t="/api/block/deleteBlock";return 解析响应体(向思源请求数据(t=t,data={id:e}))}async function 获取系统字体列表(){return 解析响应体(向思源请求数据("/api/system/getSysFonts"))}async function 获取文件(e){const t=await fetch("/api/file/getFile",{method:"POST",headers:{Authorization:`Token ${config.apitoken}`},body:JSON.stringify({path:e})});return 200===t.status?t:null}async function 写入文件(e,t,n=!1,o=Date.now()){let a=new Blob([t]),r=new File([a],e.split("/").pop()),i=new FormData;i.append("path",e),i.append("file",r),i.append("isDir",n),i.append("modTime",o);const c=await fetch("/api/file/putFile",{body:i,method:"POST",headers:{Authorization:`Token ${config.apitoken}`}});return 200===c.status?await c.json():null}const language=window.theme.languageMode;async function 推送消息(e=null,t=null,n=7e3){return 解析响应体(向思源请求数据("/api/notification/pushMsg",{msg:e?e[language]||e.other:t,timeout:n}))}function 通知(e,t=7e3){var n=new XMLHttpRequest;n.open("POST","http://127.0.0.1:6806/api/notification/pushMsg",!0),n.setRequestHeader("Content-type","application/json");var o={msg:e,timeout:7e3};n.send(JSON.stringify(o)),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status)n.responseText}}async function 推送报错消息(e=null,t=null,n=7e3){return 解析响应体(向思源请求数据("/api/notification/pushErrMsg",{msg:e?e[language]||e.other:t,timeout:n}))}function pushMessage(e){var t=new XMLHttpRequest;t.open("POST","http://127.0.0.1:6806/api/notification/pushMsg",!0),t.setRequestHeader("Content-type","application/json");var n={msg:e,timeout:7e3};t.send(JSON.stringify(n)),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status)t.responseText}}function getTextWidth(e,t){var n=(getTextWidth.canvas||(getTextWidth.canvas=document.createElement("canvas"))).getContext("2d");return n.font=t,n.measureText(e).width}function addinsertCreateElement(e,t,n=null){var o=document.createElement(t);return n&&(o.id=n),e.appendChild(o),o}function insertCreateAfter(e,t,n=null){var o=document.createElement(t);n&&(o.id=n);var a=e.parentNode;return a.lastChild===e?(a.appendChild(o),o):(a.insertBefore(o,e.nextSibling),o)}function AddEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function myRemoveEvent(e,t,n){e.addEventListener?e.removeEventListener(t,n,!1):e.attachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}function diguiTooONE(e,t){return null==e||null==t?null:function e(n){var o=n.children;if(o.length=0)return null;for(let n=0;n<o.length;n++){const r=o[n];if(t(r))return r;var a=e(r);if(null!=a)return a}return null}(e)}function getBlockSelected(){let e=document.querySelectorAll(".protyle:not(.fn__none)>.protyle-content .protyle-wysiwyg--select");return 1===e.length&&null!=e[0].dataset.nodeId?{id:e[0].dataset.nodeId,type:e[0].dataset.type,subtype:e[0].dataset.subtype,parentNode:e[0].offsetParent}:null}function removejscssfile(e,t){for(var n="js"==t?"script":"css"==t?"link":"none",o="js"==t?"src":"css"==t?"href":"none",a=document.getElementsByTagName(n),r=a.length;r>=0;r--)a[r]&&null!=a[r].getAttribute(o)&&-1!=a[r].getAttribute(o).indexOf(e)&&a[r].parentNode.removeChild(a[r])}function insertCreateBefore(e,t,n=null){var o=document.createElement(t);return n&&(o.id=n),e.parentElement.insertBefore(o,e),o}function compareVersion(e,t){const n=e.split("."),o=t.split("."),a=n.length,r=o.length,i=Math.min(a,r);let c=0;for(;c<i;c++){let e=parseInt(n[c]),t=parseInt(o[c]);if(e>t)return 1;if(e<t)return-1}if(a>r){for(let e=c;e<a;e++)if(0!=parseInt(n[e]))return 1;return 0}if(a<r){for(let e=c;e<r;e++)if(0!=parseInt(o[e]))return-1;return 0}return 0}function isEmpty(e){return null==e||""===e||"null"===e}function RangeLimitedInt(e,t,n){var o=parseInt(e,10),a=parseInt(t,10),r=parseInt(n,10),i=a<r?a:r;return o>i?o:i}function CopyDOM(e,t){var n=document.querySelector(e),o=document.querySelector(t),a=n.cloneNode(!0);o.appendChild(a)}function MoveDOM(e,t){var n=document.querySelector(e);document.querySelector(t).appendChild(n)}function MoveChildren(e,t){for(var n=document.querySelector(e),o=n.children,a=n.childElementCount,r=document.querySelector(t),i=0;i<a;i++)r.appendChild(o[0])}function isAppMode(){return!document.getElementsByTagName("body")[0].classList.contains("android")&&(!document.getElementsByTagName("body")[0].classList.contains("body--desktop")&&("windows"==window.siyuan.config.system.os||"darwin"==window.siyuan.config.system.os))}var obj={};async function bindDomWithObject(e){var t=document.getElementById(e.id),n=e.obj,o=e.prop,a=e.callback,r=e.type,i=e.updated;Object.defineProperty(n,o,{get:function(){return t.value},set:function(e){t.value=e,localStorage.setItem(o,e)},configurable:!0}),t.addEventListener(r,(function(){n[o]=n[o],"function"==typeof i&&i(n,o,t)})),"function"==typeof a&&a(e,n,t)}export async function propInit(e,t){bindDomWithObject({id:e,obj:obj,prop:e,type:t,callback:function(t,n,o){isEmpty(localStorage.getItem(e))||(n[t.prop]=localStorage.getItem(e))}})}export async function propChange(e,t){bindDomWithObject({id:e,obj:obj,prop:e,type:"change",updated:t}),t()}export async function checkedInit(e){"true"===localStorage.getItem(e.id)?e.checked=!0:e.checked=!1}export async function checkedChange(e,t,n){e.checked&&!0===e.checked?(localStorage.setItem(e.id,"true"),t()):(localStorage.setItem(e.id,"false"),n()),e.addEventListener("click",(function(){!0===e.checked?(localStorage.setItem(e.id,"true"),t()):(localStorage.setItem(e.id,"false"),n())}))}export function getTooltipDirection(e){const t=e.getBoundingClientRect(),n=t.left+t.width/2,o=t.top+t.height/2,a=1*document.documentElement.offsetWidth/3,r=2*document.documentElement.offsetWidth/3,i=1*document.documentElement.offsetHeight/3,c=2*document.documentElement.offsetHeight/3;let s;switch(!0){case o<i&&n<a:s="b3-tooltips__se";break;case o<i&&n>=a&&n<=r:s="b3-tooltips__s";break;case o<i&&n>r:s="b3-tooltips__sw";break;case o>=i&&o<=c&&n<a:s="b3-tooltips__e";break;case o>=i&&o<=c&&n>=a&&n<=r:s="b3-tooltips__s";break;case o>=i&&o<=c&&n>r:s="b3-tooltips__w";break;case o>c&&n<a:s="b3-tooltips__ne";break;case o>c&&n>=a&&n<=r:s="b3-tooltips__n";break;case o>c&&n>r:s="b3-tooltips__nw";break;default:break}return s}export function setTooltipDirection(e,...t){const n=["b3-tooltips__nw","b3-tooltips__n","b3-tooltips__ne","b3-tooltips__e","b3-tooltips__se","b3-tooltips__s","b3-tooltips__sw","b3-tooltips__w"];t.forEach((t=>{t.classList.remove(...n),t.classList.add(e(t))}))}export function getFocusedBlock(){if(document.activeElement.classList.contains("protyle-wysiwyg")){let e=window.getSelection()?.focusNode?.parentElement;for(;null!=e&&null==e?.dataset?.nodeId;)e=e.parentElement;return e}return null}export function getFocusedBlockID(){let e=getFocusedBlock();return e?e.dataset.nodeId:null}export function getFocusedDoc(){return document.querySelector("div.layout__wnd--active div.protyle:not(.fn__none) > div.protyle-content > div.protyle-wysiwyg[data-doc-type]")||document.querySelector("#editor > div.protyle-content >  div.protyle-wysiwyg[data-doc-type]")||null}export function getFocusedDocBackground(){for(var e=getFocusedDoc();null!=e&&!1===e.classList.contains("protyle-background");)e=e.previousElementSibling;return e||null}export function getFocusedDocID(){let e=getFocusedDocBackground();return e?e.dataset.nodeId:null}export function getFocusedID(){return getFocusedBlockID()||getFocusedDocID()||null}