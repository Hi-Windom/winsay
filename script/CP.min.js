import { ConfirmDialog, CPDialog } from "./module/CPM.js";
import * as CD from "./module/XML/ConfirmDialog.js";
import * as API from "./utils/api.min.js";
import * as config from "./config.js";

var barhelp = document.querySelector("#barHelp");
barhelp.addEventListener(
  "click",
  (event) => {
    console.log(event.target.parentNode.parentNode);
    if (
      event.target.parentNode.parentNode.id == "toolbarVIP" ||
      event.target.parentNode.parentNode.parentNode.id == "toolbarVIP"
    ) {
      // API.通知("该控件收纳后不支持事件");
      document.querySelector("#toolbar #barSetting").click();
      document.querySelector('.b3-tab-bar [data-name="account"]').click();
      event.stopPropagation();
    } else if (
      event.target.parentNode.id == "barMode" ||
      event.target.parentNode.parentNode.id == "barMode"
    ) {
      // API.通知("该控件收纳后不支持事件");
      document.querySelector("#toolbar #barMode").click();
      event.stopPropagation();
    } else if (
      event.target.parentNode.classList.contains("b3-menu__item") ||
      event.target.parentNode.parentNode.classList.contains("b3-menu__item")
    ) {
      console.log(event.target);
    } else if (
      event.target.id == "barTopHelp" ||
      event.target.parentNode.id == "barTopHelp"
    ) {
      event.target.id = "barHelp";
    } else {
      event.stopPropagation();
    }
  },
  true
);
barhelp.setAttribute("class", "toolbar__item");
barhelp.children[0].innerHTML = `<use xlink:href="#iconMore"></use>`;
var drawer = document.createElement("div");
drawer.id = "sc_drawer";
drawer.style.display = "flex";
drawer.style.flexDirection = "row-reverse";
drawer.style.borderBottom = "2px dashed var(--b3-theme-surface-lighter)";
drawer.style.minHeight = "2rem";

barhelp.children[1].insertAdjacentElement("afterbegin", drawer);

var localVersion = window.siyuan.config.appearance.themeVer;
// 简单省事
// new Promise(function (response) {
//   var url = `http://127.0.0.1:6806/api/file/getFile`;
//   var httpRequest = new XMLHttpRequest();
//   httpRequest.open("POST", url, true);
//   httpRequest.setRequestHeader("Content-type", "application/json");
//   var obj = {
//     path: "/conf/appearance/themes/Sofill-/theme.json",
//   };
//   httpRequest.send(JSON.stringify(obj));
//   // 响应后的回调函数
//   httpRequest.onreadystatechange = function () {
//     if (httpRequest.readyState == 4 && httpRequest.status == 200) {
//       var json = httpRequest.responseText;
//       // console.log(json);
//       response(JSON.parse(json));
//     }
//   };
// }).then(function (response) {
//   localVersion = response.version;
// });

if (API.isPhone()) {
  const leftPanel = document.getElementById("sidebar");
  if (document.getElementById("Sofill-CDUI-1") == null) {
    const CDUI_1 = document.createElement("svg");
    CDUI_1.id = "Sofill-CDUI-1";
    CDUI_1.className = "Sofill-CDUI-btn toolbar__icon";
    CDUI_1.innerHTML = `<use xlink:href="#iconSettings"></use>`;
    CDUI_1.style.width = "17px";
    CDUI_1.style.height = "100%";
    CDUI_1.style.marginLeft = "5px";
    leftPanel.children[0].insertAdjacentElement("beforeend", CDUI_1);
    let dialog = new CPDialog({
      isCancel: true,
      dragable: false, //貌似可拖拽会有问题
      maskable: true,
    });
    document.querySelector("#Sofill-CDUI-1").onclick = function () {
      dialog.open();
    };
  }
} else {
  const barHelp = document.getElementById("barHelp");
  if (document.getElementById("Sofill-CDUI-1") == null) {
    const CDUI_1 = document.createElement("button");
    CDUI_1.id = "Sofill-CDUI-1";
    CDUI_1.className = "Sofill-CDUI-btn b3-menu__item";
    CDUI_1.ariaLabel = "主题设置（实验性）";
    CDUI_1.innerHTML = `<svg class="b3-menu__icon Sofill-CDUI-btn__icon" "=""><use xlink:href="#iconSettings"></use></svg><span class="b3-menu__label">主题设置</span>`;
    barHelp.children[1].insertAdjacentElement("beforeend", CDUI_1);
    let dialog = new CPDialog({
      isCancel: true,
      dragable: false, //貌似可拖拽会有问题
      maskable: true,
    });
    document.querySelector("#Sofill-CDUI-1").onclick = function () {
      dialog.open();
      document.getElementById(
        "sc-custom-container-placehold"
      ).children[0].innerHTML = `Sofill- v${localVersion} CP`;
      document.getElementById(
        "SC_winsay_cp_version"
      ).innerHTML = `当前版本 v${localVersion}
      <div class="b3-label__text"><a href="https://gitee.com/soltus/Sofill/blob/main/CHANGELOG/winsay.md" target="_blank">浏览更新历史</a></div>`;
    };
  }
}

async function checkUpdateViaGithub(v) {
  let themes = await getBazaarTheme(window.location.host, "", {});
  console.log(themes.data);
  let localThemes = await getInstalledTheme(window.location.host, "", {});
  console.log(localThemes.data);
  new Promise(function (response) {
    var url = `https://api.github.com/repos/Hi-Windom/winsay/releases/latest`;
    var httpRequest = new XMLHttpRequest();
    httpRequest.open("GET", url, true);
    httpRequest.setRequestHeader("Content-type", "application/json");
    httpRequest.send(null);
    // 响应后的回调函数
    httpRequest.onreadystatechange = function () {
      if (httpRequest.readyState == 4 && httpRequest.status == 200) {
        var json = httpRequest.responseText;
        response(JSON.parse(json));
      }
    };
  }).then(async function (response) {
    console.log(response);
    let version = response["tag_name"];
    if (API.compareVersion(version, v) == 1) {
      console.warn("Github 有新版本发布");
      let updating = new ConfirmDialog({
        isCancel: true,
        dragable: false,
        XML: CD.ConfirmDialog4,
        success() {
          console.log("点击了确定");
          window.open(
            `https://github.com/Hi-Windom/winsay/releases/download/${version}/Sofill-__${version}.zip`,
            "_blank"
          );
          window.open(
            `https://github.com/Hi-Windom/winsay/releases/tag/${version}`,
            "_blank"
          );
        },
        cancel() {
          console.log("点击了取消");
        },
        maskable: true,
      });
      await updating.open(() => {
        document.getElementById(
          "UpdateInfo"
        ).innerHTML = `${v} => ${version}<br><span class="fn__space"></span><pre class="b3-typography" style="max-height: 288px;">${response["body"]}</pre>`;
        document.getElementById(
          "CoverWarming"
        ).innerHTML = `下载链接能否访问取决于你的网络`;
      });
      localStorage.setItem("SC_winsay_latest_checked_version", version);
    } else {
      API.通知(`真棒👍，主题已是最新版本`, 800);
    }
  });
}
async function checkUpdateViaBazaar(v) {
  let themes = await getBazaarTheme(window.location.host, "", {});
  console.log(themes.data);
  // let localThemes = await getInstalledTheme(window.location.host, "", {});
  // console.log(localThemes.data);

  let mytheme = {};
  themes.data.packages.forEach((p) => {
    p.name == "Sofill-" ? (mytheme = p) : null;
  });
  if (API.compareVersion(mytheme.version, v) == 1) {
    console.warn("集市有新版本发布");
    localStorage.setItem("SC_winsay_latest_checked_version", mytheme.version);
    API.通知(`集市有新版本发布：<br>${v} => ${mytheme.version}<br> `);
  } else {
    API.通知(`真棒👍，主题已是最新版本`, 800);
  }
}
async function getBazaarTheme(思源伺服ip, apitoken, data) {
  let url = "http://" + 思源伺服ip + "/api/bazaar/getBazaarTheme";
  return API.request(url, apitoken, data);
}
async function getInstalledTheme(思源伺服ip, apitoken, data) {
  let url = "http://" + 思源伺服ip + "/api/bazaar/getInstalledTheme";
  return API.request(url, apitoken, data);
}

async function checkUpdate() {
  let mode = localStorage.getItem("SC_winsay_cp_search__about_checkAPI");
  switch (mode) {
    case "Github":
      await checkUpdateViaGithub(localVersion);
      break;
    default:
      await checkUpdateViaBazaar(localVersion);
      break;
  }
}

var obj = {};

function bindDomWithObject(options) {
  var dom = document.getElementById(options.id); // 获取dom id
  var obj = options.obj; // 需要绑定的obj
  var prop = options.prop; // 需要绑定的obj 的属性
  var callback = options.callback; // 绑定成功后调用
  var type = options.type; // 绑定的事件类型
  var updated = options.updated; // 更新成功后调用

  Object.defineProperty(obj, prop, {
    get: function () {
      return dom.value;
    },
    set: function (value) {
      dom.value = value;
      localStorage.setItem(prop, value);
    },
    configurable: true,
  });

  dom.addEventListener(type, function () {
    obj[prop] = obj[prop];
    if (typeof updated === "function") {
      updated(obj, prop, dom); // 传入对象， 修改的属性， 以及dom节点
    }
  });

  if (typeof callback === "function") {
    callback(options, obj, dom);
  }
}

function propInit(id, type) {
  bindDomWithObject({
    id: id,
    obj: obj,
    prop: id,
    type: type,
    callback: function (options, obj, dom) {
      if (!API.isEmpty(localStorage.getItem(id))) {
        obj[options.prop] = localStorage.getItem(id);
      }
    },
  });
  console.log(`${id} binded successfully`);
}

function propChange(id, changeFn) {
  bindDomWithObject({
    id: id,
    obj: obj,
    prop: id,
    type: "change",
    updated: changeFn,
  });
  changeFn();
}

function checkedInit(obj) {
  if (localStorage.getItem(obj.id) === "true") {
    obj.checked = true;
  } else {
    obj.checked = false;
  }
  console.log(`${obj.id} binded successfully`);
}

function checkedChange(obj, YesFn, NoFn) {
  if (obj.checked && obj.checked === true) {
    localStorage.setItem(obj.id, "true");
    YesFn();
  } else {
    localStorage.setItem(obj.id, "false");
    NoFn();
  }
  obj.addEventListener("click", function () {
    if (obj.checked === true) {
      localStorage.setItem(obj.id, "true");
      YesFn();
    } else {
      localStorage.setItem(obj.id, "false");
      NoFn();
    }
  });
}

// 初始化选项的值
let selectList = document.querySelectorAll("select[id^='SC_winsay_cp']");
// console.log(selectList);
selectList.forEach(function (value) {
  propInit(value.id, "change");
});
let rangeSliderList = document.querySelectorAll(
  "input[id^='SC_winsay_cp'][type='range']"
);
// console.log(rangeSliderList);
rangeSliderList.forEach(function (value) {
  propInit(value.id, "change");
});
let checkboxList = document.querySelectorAll(
  "input[id^='SC_winsay_cp'][type='checkbox']"
);
// console.log(checkboxList);
checkboxList.forEach(function (value) {
  checkedInit(value);
});
// 支持记忆主题设置界面 #499
let navLatest = localStorage.getItem("SC_winsay_cp_custom-nav-bind-id");
if (!API.isEmpty(navLatest)) {
  document.getElementById(navLatest).checked = "true";
}
let navList = document.querySelectorAll(
  "input[id^='sc-custom-nav-bind-id'][type='radio']"
);
navList.forEach(function (value) {
  checkedChange(
    value,
    () => {
      localStorage.setItem("SC_winsay_cp_custom-nav-bind-id", value.id);
    },
    () => {}
  );
});

// 按钮监听事件
document
  .getElementById("SC_winsay_cp_system__ClearlocalStorage")
  .addEventListener("click", function () {
    let clearAll = new ConfirmDialog({
      isCancel: true,
      dragable: false,
      XML: CD.ConfirmDialog1,
      success() {
        console.log("点击了确定");
        var counter = 0;
        for (var i = 0; i < localStorage.length; i++) {
          var key = localStorage.key(i);
          if (key.startsWith("winsay_") || key.startsWith("SC_winsay_")) {
            localStorage.removeItem(key);
            console.log(`${key} removed`);
            counter++;
          }
        }
        // 简单粗暴的执行两次
        for (var i = 0; i < localStorage.length; i++) {
          var key = localStorage.key(i);
          if (key.startsWith("winsay_") || key.startsWith("SC_winsay_")) {
            localStorage.removeItem(key);
            console.log(`${key} removed`);
            counter++;
          }
        }
        API.通知(`已清理 ${counter} 项<br>页面即将刷新`);
        setTimeout(() => {
          window.location.reload();
        }, 3000);
      },
      cancel() {
        console.log("点击了取消");
      },
      maskable: true,
    });

    clearAll.open();
  });

document
  .getElementById("SC_winsay_cp_system__ResetAllSettings")
  .addEventListener("click", function () {
    let clearAll = new ConfirmDialog({
      isCancel: true,
      dragable: false,
      XML: CD.ConfirmDialog2,
      success() {
        console.log("点击了确定");
        var counter = 0;
        for (var i = 0; i < localStorage.length; i++) {
          var key = localStorage.key(i);
          if (key.startsWith("SC_winsay_cp")) {
            localStorage.removeItem(key);
            console.log(`${key} removed`);
            counter++;
          }
        }
        // 简单粗暴的执行两次
        for (var i = 0; i < localStorage.length; i++) {
          var key = localStorage.key(i);
          if (key.startsWith("SC_winsay_cp")) {
            localStorage.removeItem(key);
            console.log(`${key} removed`);
            counter++;
          }
        }
        API.通知(`已重置 ${counter} 项<br>页面即将刷新`);
        setTimeout(() => {
          window.location.reload();
        }, 3000);
      },
      cancel() {
        console.log("点击了取消");
      },
      maskable: true,
    });

    clearAll.open();
  });

document
  .getElementById("SC_winsay_cp_system__Refresh")
  .addEventListener("click", function () {
    setTimeout(() => {
      window.location.reload();
    }, 300);
  });

  document
  .getElementById("SC_winsay_cp_system__ShowDebugInfo")
  .addEventListener("click", function () {
    setTimeout(() => {
      let info = new ConfirmDialog({
        isCancel: true,
        dragable: false,
        XML: CD.ConfirmDialog5,
        success() {
          console.log("点击了确定");
        },
        cancel() {
          console.log("点击了取消");
        },
        maskable: false,
      });

      info.open(() => {
        document.getElementById(
          "UpdateInfo"
        ).innerHTML = `
<div style="max-height: 58vh;overflow: auto;white-space: nowrap;">
localIPs  <br><code class="fn__code">${window.siyuan.config.localIPs}</code><br><br>
api.token  <br><code class="fn__code">${window.siyuan.config.api.token}</code><br><br>
system.homeDir  <br><code class="fn__code">${window.siyuan.config.system.homeDir}</code><br><br>
system.workspaceDir  <br><code class="fn__code">${window.siyuan.config.system.workspaceDir}</code><br><br>
system.confDir  <br><code class="fn__code">${window.siyuan.config.system.confDir}</code><br><br>
system.dataDir  <br><code class="fn__code">${window.siyuan.config.system.dataDir}</code><br><br>
appearance.darkThemes  <br><code class="fn__code">${window.siyuan.config.appearance.darkThemes}</code><br><br>
appearance.lightThemes  <br><code class="fn__code">${window.siyuan.config.appearance.lightThemes}</code><br><br>
appearance.mode  <br><code class="fn__code">${window.siyuan.config.appearance.mode}</code><br><br>
appearance.themeDark  <br><code class="fn__code">${window.siyuan.config.appearance.themeDark}</code><br><br>
appearance.themeLight  <br><code class="fn__code">${window.siyuan.config.appearance.themeLight}</code><br><br>
appearance.themeVer  <br><code class="fn__code">${window.siyuan.config.appearance.themeVer}</code><br><br>
appearance.blockRefTextLeft  <br><code class="fn__code">${window.siyuan.config.export.blockRefTextLeft}</code><br><br>
appearance.blockRefTextRight  <br><code class="fn__code">${window.siyuan.config.export.blockRefTextRight}</code><br><br>
fileTree.maxOpenTabCount（页签打开最大数量）  <br><code class="fn__code">${window.siyuan.config.fileTree.maxOpenTabCount}</code><br><br>
system.fixedPort（是否固定端口）  <br><code class="fn__code">${window.siyuan.config.system.fixedPort}</code><br><br>
appearance.hideStatusBar（修改没有效果，仅用于判断是否隐藏底部状态栏）  <br><code class="fn__code">${window.siyuan.config.appearance.hideStatusBar}</code><br><br>
appearance.customCSS（是否开启自定义主题）  <br><code class="fn__code">${window.siyuan.config.appearance.customCSS}</code>
</div>
`;
      });
    }, 300);
  });

document
  .getElementById("SC__exportData")
  .addEventListener("click", function () {
    var link = document.querySelector("#SC__exportData_a"); //  选择链接
    var counter = 0;
    var ok = 0;
    var jsonData = {};
    for (var i = 0; i < localStorage.length; i++) {
      var key = localStorage.key(i);
      if (key.startsWith("winsay_") || key.startsWith("SC_winsay_")) {
        try {
          jsonData[key] = localStorage.getItem(key);
          ok++;
        } catch (e) {
          console.error(`${key} is not a valid value for ${e}`);
          jsonData[key] = null;
        } finally {
          counter++;
        }
      }
    }
    var blob = new Blob([JSON.stringify(jsonData)]);
    link.href = URL.createObjectURL(blob); //  创建一个 URL 对象并传给 a 的 href
    link.download = `Sofill-ConfigData.json`; //  设置下载的默认文件名
    link.click(); //  点击下载链接
    API.通知(`导出成功 ${ok}/${counter}`);
  });

document
  .getElementById("SC__importData")
  .addEventListener("click", function () {
    var fileSelect = document.querySelector("#SC__importData_i"); //  选择链接
    //  文件表单的内容改变，也就是文件选择完成
    fileSelect.onchange = function () {
      if (this.value === "" || this.files.length < 1) {
        console.warn("Oops...");
        return false; //  如果没有选择文件就什么也不做
      }
      var counter = 0;
      var diff = 0;
      var diffDetail = {};
      var ok = 0;
      var reader = new FileReader(); //  创建 FileReader对象
      reader.readAsText(this.files[0]); //  把文件读取为字符串
      //  文件加载完成
      reader.onload = async function (ev) {
        var jsonStr = ev.target.result; //  把字符串传给 jsonStr
        try {
          jsonStr = JSON.parse(jsonStr); //  把 JSON 字符串转换为 JSON 对象
        } catch (e) {
          API.通知(`无效数据 ${e}`, 3000);
          return;
        }
        console.log(jsonStr); //  在控制台输出 JSON
        for (var val in jsonStr) {
          counter = counter + 1;
          if (jsonStr[val] != localStorage.getItem(val)) {
            diff = diff + 1;
            diffDetail[val] = `${localStorage.getItem(val)} => ${jsonStr[val]}`;
          }
        }
        console.warn(
          "================================ Changes Preview ================================"
        );
        var i = 1;
        for (var val in diffDetail) {
          console.log(`${i}. ${val} : ${diffDetail[val]}`);
          i++;
        }
        console.warn(
          "================================================================================"
        );

        let coverAll = new ConfirmDialog({
          isCancel: true,
          dragable: false,
          XML: CD.ConfirmDialog3,
          success() {
            console.log("点击了确定");
            for (var val in jsonStr) {
              try {
                localStorage.setItem(val, jsonStr[val]);
                ok = ok + 1;
                console.warn(`${val} updated`);
              } catch (e) {
                console.error(e);
              }
            }
            API.通知(`导入成功 ${ok}/${counter}，覆盖 ${diff} 项`);
            if (diff > 0) {
              setTimeout(() => {
                window.location.reload();
              }, 1000);
            }
          },
          cancel() {
            console.log("点击了取消");
          },
          maskable: true,
        });
        await coverAll.open(() => {
          document.getElementById(
            "CoverWarming"
          ).innerHTML = `影响 ${diff}/${counter} 项`;
        });
      };
    };
    fileSelect.value = ""; // 避免重复导入无法取值
  });

document
  .getElementById("SC_winsay_cp__checkUpdateBtn")
  .addEventListener("click", function () {
    checkUpdate();
  });

// ------------------ 选项改变时的业务处理 ------------------------
propChange("SC_winsay_cp_editor__block__popover--open__PinSense", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__block__popover--open__PinSense");
  if (!API.isEmpty(i)) {
    switch (i) {
      case "2":
        document.documentElement.style.setProperty(
          "--SCC-Variables-block__popover--open__PinSense_2",
          "var(--b3-theme-secondary) -2px -2px 5.8px 1px,var(--b3-theme-primary) 0 0 0 1px,var(--b3-theme-primary-light) 0 0 3px 1px,var(--b3-theme-primary-lighter) 0 0 13px 2px,var(--b3-theme-primary-lightest) 0 0 2px 4px"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-block__popover--open__PinSense_1",
          "unset"
        );
        break;
      case "1":
        document.documentElement.style.setProperty(
          "--SCC-Variables-block__popover--open__PinSense_2",
          "var(--b3-dialog-shadow)"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-block__popover--open__PinSense_1",
          "var(--b3-theme-surface-lighter)"
        );
        break;
    }
  } else {
    document.documentElement.style.setProperty(
      "--SCC-Variables-block__popover--open__PinSense_1",
      "unset"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-block__popover--open__PinSense_2",
      "var(--b3-dialog-shadow)"
    );
  }
});
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__CoolToolBar"),
  () => {
    API.MoveDOM("#barTopHelp", "#sc_drawer");
    API.MoveDOM("#toolbarVIP", "#sc_drawer");
    API.CopyDOM("#barMode", "#sc_drawer");
    document.querySelector("#toolbar #barMode").style.width = "0";
    document.querySelector("#toolbar #barMode").style.padding = "0";
  },
  () => {
    document
      .querySelector("#barSetting")
      .insertAdjacentElement("afterend", document.querySelector("#barTopHelp"));
    document
      .querySelector("#toolbar")
      .insertAdjacentElement(
        "afterbegin",
        document.querySelector("#toolbarVIP")
      );
      let old = document.querySelector("#sc_drawer #barMode");
      old ? old.remove() : null;
    document.querySelector("#toolbar #barMode").style.width = "auto";
    document.querySelector("#toolbar #barMode").style.padding = "9px";
  }
);
propChange("SC_winsay_cp_appearance__TabBarSize", function () {
  var i = localStorage.getItem("SC_winsay_cp_appearance__TabBarSize");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-TabBar-FontSize",
      i
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-TabBar-MinHeight",
      parseInt(i) * 3
    );
  }
});
propChange("SC_winsay_cp_editor__BlockTable_MinWidth", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__BlockTable_MinWidth");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-minWidth",
      i
    );
  } else {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-minWidth",
      "unset"
    );
  }
});
propChange("SC_winsay_cp_editor__BlockTable_MaxWidth", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__BlockTable_MaxWidth");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-maxWidth",
      i
    );
  } else {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-maxWidth",
      "unset"
    );
  }
});
propChange("SC_winsay_cp_editor__BlockTable_FontSize", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__BlockTable_FontSize");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-fontSize",
      i
    );
  } else {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-fontSize",
      "unset"
    );
  }
});
propChange("SC_winsay_cp_editor__BlockTable_TextAlign", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__BlockTable_TextAlign");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-text_align",
      i
    );
  } else {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-text_align",
      "unset"
    );
  }
});
checkedChange(
  document.getElementById("SC_winsay_cp_editor__BlockTable_Margin"),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-margin",
      "0 auto"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockTable-margin",
      "inherit"
    );
  }
);
propChange("SC_winsay_cp_search__about_checkTime", function () {
  var i = localStorage.getItem("SC_winsay_cp_search__about_checkTime");
  if (!API.isEmpty(i)) {
    switch (i) {
      case "Once":
        if (document.querySelector("#SC-CP").style.display == "none") {
          setTimeout(() => {
            checkUpdate();
          }, 3100);
        }
        break;
      default:
        break;
    }
  }
});
propChange("SC_winsay_cp_custom__EXTmaxOpenTabCount", function () {
  var i = localStorage.getItem("SC_winsay_cp_custom__EXTmaxOpenTabCount");
  if (!API.isEmpty(i)) {
    let o = localStorage.getItem("SC_winsay_cp_custom__EXTmaxOpenTabCount__origin");
    if (API.isEmpty(o)) {
      localStorage.setItem("SC_winsay_cp_custom__EXTmaxOpenTabCount__origin", window.siyuan.config.fileTree.maxOpenTabCount);
    }
    window.siyuan.config.fileTree.maxOpenTabCount = parseInt(i);
  } else {
    let o = localStorage.getItem("SC_winsay_cp_custom__EXTmaxOpenTabCount__origin");
    if (!API.isEmpty(o)) {
      window.siyuan.config.fileTree.maxOpenTabCount = parseInt(o);
      localStorage.removeItem("SC_winsay_cp_custom__EXTmaxOpenTabCount__origin");
    }
  }
});
propChange("SC_winsay_cp_appearance__TabBarStyleFeel", function () {
  var i = localStorage.getItem(
    "SC_winsay_cp_appearance__TabBarStyleFeel"
  );
  if (!API.isEmpty(i)) {
    switch (i) {
      case "3":
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-item__focus-box-shadow",
          "rgba(131, 131, 131, 0.4) 0px 2px 4px, rgba(131, 131, 131, 0.3) 0px 7px 3px -3px, rgba(131, 131, 131, 0.2) 0px -3px 0px inset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-item-box-shadow",
          "rgba(131, 131, 131, 0.4) 0px 2px 4px, rgba(131, 131, 131, 0.3) 0px 7px 3px -3px, rgba(131, 131, 131, 0.2) 0px -3px 0px inset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-V__item-box-shadow",
          "rgb(131 131 131 / 30%) 0px 1px 1px, rgb(131 131 131 / 20%) 0px 2px 2px -2px, rgb(131 131 131 / 20%) 0px -1px 0px inset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-border-bottom",
          "2px ridge var(--b3-theme-primary-light)"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-margin-bottom",
          "3px"
        );
        break;
      case "2":
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-item__focus-box-shadow",
          "rgba(131, 131, 131, 0.4) 0px 2px 4px, rgba(131, 131, 131, 0.3) 0px 7px 3px -3px, rgba(131, 131, 131, 0.2) 0px -3px 0px inset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-item-box-shadow",
          "rgba(131, 131, 131, 0.4) 0px 2px 4px, rgba(131, 131, 131, 0.3) 0px 7px 3px -3px, rgba(131, 131, 131, 0.2) 0px -3px 0px inset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-V__item-box-shadow",
          "rgb(131 131 131 / 30%) 0px 1px 1px, rgb(131 131 131 / 20%) 0px 2px 2px -2px, rgb(131 131 131 / 20%) 0px -1px 0px inset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-border-bottom",
          "none"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-margin-bottom",
          "3px"
        );
        break;
      case "1":
      default:
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-item__focus-box-shadow",
          "rgb(131 131 131 / 1%) -1px 1px 1px, rgb(131 131 131 / 11%) -1px -2px 13px -1px, rgb(131 131 131 / 3%) 0px -1px 0px inset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-item-box-shadow",
          "rgb(131 131 131 / 1%) -1px 1px 1px, rgb(131 131 131 / 11%) -1px -2px 13px -1px, rgb(131 131 131 / 3%) 0px -1px 0px inset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-V__item-box-shadow",
          "none"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-border-bottom",
          "1px solid var(--b3-theme-primary-light)"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar-margin-bottom",
          "0px"
        );
        break;
    }
  } else {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockList__beforeColor",
      "var(--b3-theme-surface-lighter)"
    );
  }
});
propChange("SC_winsay_cp_appearance__TabBar_item__textShadow", function () {
  var i = localStorage.getItem(
    "SC_winsay_cp_appearance__TabBar_item__textShadow"
  );
  if (!API.isEmpty(i)) {
    switch (i) {
      case "2":
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar_item__textShadow",
          "-1px 1px 13px var(--SCC-Orange-Windom)"
        );
        break;
      case "1":
      default:
        document.documentElement.style.setProperty(
          "--SCC-Variables-TabBar_item__textShadow",
          "none"
        );
        break;
    };
  }
});
propChange("SC_winsay_cp_editor__Block-List-LightUpLineMode", function () {
  var i = localStorage.getItem(
    "SC_winsay_cp_editor__Block-List-LightUpLineMode"
  );
  if (!API.isEmpty(i)) {
    switch (i) {
      case "1":
        document.documentElement.style.setProperty(
          "--SCC-Variables-BlockList__beforeColor",
          "var(--b3-theme-background-light)"
        );
        window.funs.updateStyle("BlockListHoverALL", ``);
        break;
      case "2":
        document.documentElement.style.setProperty(
          "--SCC-Variables-BlockList__beforeColor",
          "var(--b3-theme-background-light)"
        );
        window.funs.updateStyle(
          "BlockListHoverALL",
          `/appearance/themes/Sofill-/style/sweet/sugar/editor/Block-List-HoverALL.css`
        );
        break;
      case "3":
        document.documentElement.style.setProperty(
          "--SCC-Variables-BlockList__beforeColor",
          "var(--b3-scroll-color)"
        );
        break;
      case "4":
      default:
        document.documentElement.style.setProperty(
          "--SCC-Variables-BlockList__beforeColor",
          "var(--b3-theme-surface-lighter)"
        );
        break;
    }
  } else {
    document.documentElement.style.setProperty(
      "--SCC-Variables-BlockList__beforeColor",
      "var(--b3-theme-surface-lighter)"
    );
  }
});
propChange("SC_winsay_cp_appearance__TabBarMode", function () {
  var i = localStorage.getItem("SC_winsay_cp_appearance__TabBarMode");
  var j = API.isEmpty(i) ? "sweet/MI-TabBar-D.css" : i;
  window.funs.updateStyle("TabBar", `/appearance/themes/Sofill-/style/${j}`);
});
propChange("SC_winsay_cp_custom__defaultS", function () {
  var i = localStorage.getItem("SC_winsay_cp_custom__defaultS");
  var j = API.isEmpty(i) ? "root.css" : i;
  window.funs.updateStyle("custom-id-style-theme-color", `/appearance/themes/Sofill-/style-S2/${j}`);
});
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__TabBarV_AutoFolded"),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-TabBarV_Auto-width",
      "2rem"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-TabBarV_Auto-width",
      "max(186px, 13vw)"
    );
  }
);
propChange("SC_winsay_cp_search__layout", function () {
  var i = localStorage.getItem("SC_winsay_cp_search__layout");
  var j = API.isEmpty(i) ? "layout-Auto.css" : i;
  window.funs.updateStyle(
    "search__layout",
    `/appearance/themes/Sofill-/style/sweet/sugar/search/${j}`
  );
});
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__ToolBarMode"),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-height-max",
      "11px"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-child-visibility",
      "hidden"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-svg-height",
      `0px`
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-height-max",
      "37px"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-child-visibility",
      "visible"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-svg-height",
      `14px`
    );
  }
);
propChange("SC_winsay_cp_appearance__ToolBarMode__height", function () {
  var h = localStorage.getItem("SC_winsay_cp_appearance__ToolBarMode__height");
  if (!API.isEmpty(h)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-height",
      h
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-svg-height",
      `${parseInt(h) / 2 + 1}px`
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-svg-hover-height",
      `${parseInt(h) / 2 + 1}px`
    );
  }
});
propChange(
  "SC_winsay_cp_appearance__ToolBarMode__NotFocus__bgColor",
  function () {
    var h = localStorage.getItem(
      "SC_winsay_cp_appearance__ToolBarMode__NotFocus__bgColor"
    );
    if (!API.isEmpty(h)) {
      document.documentElement.style.setProperty("--b3-toolbar-background", h);
    }
  }
);
var t = null; // 声明计时器
var SC_winsay_cp_editor__DocWidthMode__previousValue = "null";
propChange("SC_winsay_cp_editor__DocWidthMode", function () {
  var w = localStorage.getItem("SC_winsay_cp_editor__DocWidthMode");
  clearInterval(t);
  if (!API.isEmpty(w)) {
    SC_winsay_cp_editor__DocWidthMode__previousValue = w;
    t = setInterval(function () {
      var node1 = document.querySelectorAll(
        "#layouts .layout__center .protyle-wysiwyg.protyle-wysiwyg--attr"
      );
      var node2 = document.querySelectorAll(
        "#layouts .layout__center .protyle-title.protyle-wysiwyg--attr"
      );
      node1.forEach(function (item) {
        item.style.setProperty("padding", w);
      });
      node2.forEach(function (item) {
        item.style.setProperty("margin", w);
      });
    }, 1000);
  } else if (
    SC_winsay_cp_editor__DocWidthMode__previousValue != w &&
    w != null
  ) {
    window.location.reload();
  }
});
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__DockBgColorFilter"),
  () => {
    document
      .querySelector("#dockLeft")
      .style.setProperty(
        "background-image",
        "linear-gradient(to top,#cccccc16,#ffffff06)"
      );
    document
      .querySelector("#dockRight")
      .style.setProperty(
        "background-image",
        "linear-gradient(to top left,#cccccc16,#ffffff06)"
      );
    document
      .querySelector("#status")
      .style.setProperty(
        "background-image",
        "linear-gradient(to top right,#cccccc16,#ffffff06)"
      );
  },
  () => {
    document
      .querySelector("#dockLeft")
      .style.removeProperty("background-image");
    document
      .querySelector("#dockRight")
      .style.removeProperty("background-image");
    document.querySelector("#status").style.removeProperty("background-image");
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__ToolBarMode__HideList__docName"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-docName-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-docName-opacity",
      "0.77"
    );
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__ToolBarMode__HideList__VIP"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-VIP-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-VIP-opacity",
      "0.77"
    );
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__ToolBarMode__HideList__windowX"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-windowX-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-windowX-opacity",
      "0.77"
    );
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__ToolBarMode__HideList__Other"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-Other-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-ToolBar-Other-opacity",
      "0.77"
    );
  }
);
propChange("SC_winsay_cp_editor__ListAutoIndent_mode", function () {
  var value = localStorage.getItem("SC_winsay_cp_editor__ListAutoIndent_mode");
  if (!API.isEmpty(value) && value == "2") {
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-margin",
      "max(min(18px,0.58em),8px)"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-padding",
      "min(16px,0.31em)"
    );
  } else if (!API.isEmpty(value) && value == "1") {
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-margin",
      "max(min(18px,1cqw),8px)"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-padding",
      "min(16px,0.58cqw)"
    );
  } else {
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-margin",
      "18px"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-List-Item-padding",
      "16px"
    );
  }
});
propChange("SC_winsay_cp_editor__img-bg-color", function () {
  var value = localStorage.getItem("SC_winsay_cp_editor__img-bg-color");
  if (!API.isEmpty(value)) {
    switch (localStorage.getItem("SC_winsay_cp_editor__img-bg-color_always")) {
      case "true":
        document.documentElement.style.setProperty(
          "--SCC-Variables-IMG-bg-color_hover",
          value
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-IMG-bg-color",
          value
        );
        break;
      default:
        document.documentElement.style.setProperty(
          "--SCC-Variables-IMG-bg-color_hover",
          value
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-IMG-bg-color",
          "transparent"
        );
    }
  }
});
checkedChange(
  document.getElementById("SC_winsay_cp_editor__img-bg-color_always"),
  () => {
    var value = localStorage.getItem("SC_winsay_cp_editor__img-bg-color");
    document.documentElement.style.setProperty(
      "--SCC-Variables-IMG-bg-color_hover",
      value
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-IMG-bg-color",
      value
    );
  },
  () => {
    var value = localStorage.getItem("SC_winsay_cp_editor__img-bg-color");
    document.documentElement.style.setProperty(
      "--SCC-Variables-IMG-bg-color_hover",
      value
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-IMG-bg-color",
      "transparent"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_filetree__Hide_untitle"),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-Untitle-opacity",
      "0"
    );
  },
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-Untitle-opacity",
      "1"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_search__index"),
  () => {
    window.funs.updateStyle(
      "search__index",
      `/appearance/themes/Sofill-/style/sweet/sugar/search/index.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/sugar/search/index.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_editor__HintHint-index"),
  () => {
    window.funs.updateStyle(
      "HintHint-index",
      `/appearance/themes/Sofill-/style/sweet/sugar/editor/HintHint-index.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/sugar/editor/HintHint-index.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_editor__LH_Adaptive"),
  () => {
    window.funs.updateStyle(
      "LH_Adaptive",
      `/appearance/themes/Sofill-/style/sweet/LH-Adaptive.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/LH-Adaptive.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_editor__BreadcrumbsMode-Adaptive"),
  () => {
    window.funs.updateStyle(
      "docBreadcrumb_Adaptive",
      `/appearance/themes/Sofill-/style/sweet/MI-Breadcrumb-Adaptive.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/MI-Breadcrumb-Adaptive.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_editor__AreoBg-Filter"),
  () => {
    window.funs.updateStyle(
      "AreoBg-Filter",
      `/appearance/themes/Sofill-/style/sweet/AreoBg-Filter.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/AreoBg-Filter.css`,
      "css"
    );
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__ShowWebIcon"),
  () => {
    window.funs.updateStyle(
      "ShowWebIcon",
      `/appearance/themes/Sofill-/style/link/web.css`
    );
  },
  () => {
    API.removejscssfile(`${config.THEME_ROOT}style/link/web.css`, "css");
  }
);
checkedChange(
  document.getElementById("SC_winsay_cp_appearance__ShowFileIcon"),
  () => {
    window.funs.updateStyle(
      "ShowFileIcon",
      `/appearance/themes/Sofill-/style/link/file.css`
    );
  },
  () => {
    API.removejscssfile(`${config.THEME_ROOT}style/link/file.css`, "css");
  }
);
propChange(
  "SC_winsay_cp_editor__Block-Inline-link__block-ref-content",
  function () {
    var i = localStorage.getItem(
      "SC_winsay_cp_editor__Block-Inline-link__block-ref-content"
    );
    if (!API.isEmpty(i)) {
      var before = i.split(" ")[0];
      var after = i.split(" ")[1];
      document.documentElement.style.setProperty(
        "--SCC-Variables-Block-Inline-link__block-ref__before",
        `'${before}'`
      );
      document.documentElement.style.setProperty(
        "--SCC-Variables-Block-Inline-link__block-ref__after",
        `'${after}'`
      );
    } else {
      document.documentElement.style.setProperty(
        "--SCC-Variables-Block-Inline-link__block-ref__before",
        "none"
      );
      document.documentElement.style.setProperty(
        "--SCC-Variables-Block-Inline-link__block-ref__after",
        "none"
      );
    }
  }
);
propChange(
  "SC_winsay_cp_editor__Block-List-Task__item-done__text-color",
  function () {
    var i = localStorage.getItem(
      "SC_winsay_cp_editor__Block-List-Task__item-done__text-color"
    );
    if (!API.isEmpty(i) && i == "auto") {
      document.documentElement.style.setProperty(
        "--SCC-Variables-Block-List-Task__item-done-color",
        "var(--b3-theme-secondary)"
      );
      document.documentElement.style.setProperty(
        "--SCC-Variables-Block-List-Task__item-done-backdrop-filter",
        "brightness(1.58) blur(13px)"
      );
    } else {
      document.documentElement.style.setProperty(
        "--SCC-Variables-Block-List-Task__item-done-color",
        "var(--b3-theme-on-background)"
      );
      document.documentElement.style.setProperty(
        "--SCC-Variables-Block-List-Task__item-done-backdrop-filter",
        "none"
      );
    }
  }
);
propChange("SC_winsay_cp_appearance__status_msg_opacity", function () {
  var i = localStorage.getItem("SC_winsay_cp_appearance__status_msg_opacity");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-status__msg_opacity",
      i
    );
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__pIndent", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__pIndent");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-pIndent",
      `${API.RangeLimitedInt(-5, i, 20)}rem`
    );
    document.getElementById("SC_winsay_cp_editor__LH_Adaptive__pIndent").value =
      API.RangeLimitedInt(-5, i, 20);
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__LH", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__LH");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-LH",
      `${i}`
    );
    document
      .getElementById("SC_winsay_cp_editor__LH_Adaptive__LH__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem("SC_winsay_cp_editor__LH_Adaptive__LH__label", i);
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__marginTop", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__marginTop");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-marginTop",
      `${API.RangeLimitedInt(100, i, 500) / 100}rem`
    );
    document.getElementById(
      "SC_winsay_cp_editor__LH_Adaptive__marginTop"
    ).value = API.RangeLimitedInt(100, i, 500);
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__marginBottom", function () {
  var i = localStorage.getItem(
    "SC_winsay_cp_editor__LH_Adaptive__marginBottom"
  );
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-marginBottom",
      `${API.RangeLimitedInt(100, i, 500) / 100}rem`
    );
    document.getElementById(
      "SC_winsay_cp_editor__LH_Adaptive__marginBottom"
    ).value = API.RangeLimitedInt(100, i, 500);
  }
});
propChange("SC_winsay_cp_editor__LH_Adaptive__lSpacing", function () {
  var i = localStorage.getItem("SC_winsay_cp_editor__LH_Adaptive__lSpacing");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-Doc-lSpacing",
      `${i}rem`
    );
    document
      .getElementById("SC_winsay_cp_editor__LH_Adaptive__lSpacing__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem(
      "SC_winsay_cp_editor__LH_Adaptive__lSpacing__label",
      i
    );
  }
});
propChange("SC_winsay_cp_editor__BlockScrollBar-opacity", function () {
  var o = localStorage.getItem("SC_winsay_cp_editor__BlockScrollBar-opacity");
  if (!API.isEmpty(o)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-BlockScrollBar-opacity-hover",
      o
    );
    switch (o) {
      case "0.58":
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-opacity",
          "0.58"
        );
        break;
      default:
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-opacity",
          "0"
        );
        break;
    }
  }
});
propChange("SC_winsay_cp_editor__BlockScrollBar_Hposition", function () {
  var p = localStorage.getItem("SC_winsay_cp_editor__BlockScrollBar_Hposition");
  if (!API.isEmpty(p)) {
    switch (p) {
      case "L31":
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-right",
          "unset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-left",
          "31px"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-tooltips-top",
          "-100%"
        );
        break;
      case "L13":
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-right",
          "unset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-left",
          "13px"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-tooltips-top",
          "-100%"
        );
        break;
      case "R31":
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-right",
          "31px"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-left",
          "unset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-tooltips-top",
          "100%"
        );
        break;
      case "R13":
      default:
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-right",
          "13px"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-left",
          "unset"
        );
        document.documentElement.style.setProperty(
          "--SCC-Variables-MI-BlockScrollBar-tooltips-top",
          "100%"
        );
        break;
    }
  }
});
checkedChange(
  document.getElementById("SC_winsay_cp_filetree__Adaptive_display"),
  () => {
    window.funs.updateStyle(
      "MI-DocTree-Adaptive",
      `/appearance/themes/Sofill-/style/sweet/MI-DocTree-Adaptive.css`
    );
  },
  () => {
    API.removejscssfile(
      `${config.THEME_ROOT}style/sweet/MI-DocTree-Adaptive.css`,
      "css"
    );
  }
);
propChange("SC_winsay_cp_filetree__docFontsize", function () {
  var i = localStorage.getItem("SC_winsay_cp_filetree__docFontsize");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-docFontsize",
      `${i}pt`
    );
    document
      .getElementById("SC_winsay_cp_filetree__docFontsize__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem("SC_winsay_cp_filetree__docFontsize__label", i);
  }
});
propChange("SC_winsay_cp_filetree__nbFontsize", function () {
  var i = localStorage.getItem("SC_winsay_cp_filetree__nbFontsize");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-nbFontsize",
      `${i}pt`
    );
    document
      .getElementById("SC_winsay_cp_filetree__nbFontsize__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem("SC_winsay_cp_filetree__nbFontsize__label", i);
  }
});
propChange("SC_winsay_cp_filetree__nbMargin", function () {
  var i = localStorage.getItem("SC_winsay_cp_filetree__nbMargin");
  if (!API.isEmpty(i)) {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-DocTree-nbMargin",
      `${i}em`
    );
    document
      .getElementById("SC_winsay_cp_filetree__nbMargin__label")
      .setAttribute("aria-label", `${i}`);
    localStorage.setItem("SC_winsay_cp_filetree__nbMargin__label", i);
  }
});
checkedChange(
  document.getElementById("SC_winsay_cp_editor__FocusEnhanc_inlineCode"),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-Inline-span__code__before-content",
      "'<'"
    );
    document.documentElement.style.setProperty(
      "--SCC-Variables-Block-Inline-span__code__after-content",
      "'>'"
    );
  },
  () => {
    document.documentElement.style.removeProperty(
      "--SCC-Variables-Block-Inline-span__code__before-content"
    );
    document.documentElement.style.removeProperty(
      "--SCC-Variables-Block-Inline-span__code__after-content"
    );
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__strengthen_backlinkList_panel_border"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-backlinkList_panel_box-shadow",
      "rgb(6 24 44 / 8%) -31px -13px 131px 12px, rgb(186 186 186 / 22%) 12px -23px 111px -5px inset"
    );
  },
  () => {
    document.documentElement.style.removeProperty(
      "--SCC-Variables-backlinkList_panel_box-shadow"
    );
  }
);
checkedChange(
  document.getElementById(
    "SC_winsay_cp_appearance__strengthen_layout-tab-container"
  ),
  () => {
    document.documentElement.style.setProperty(
      "--SCC-Variables-MI-LayoutTabContainer_bgColor",
      "linear-gradient(95deg, transparent, var(--b3-theme-surface-lighter), transparent)"
    );
  },
  () => {
    document.documentElement.style.removeProperty(
      "--SCC-Variables-MI-LayoutTabContainer_bgColor"
    );
  }
);
